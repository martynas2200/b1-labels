// ==UserScript==
// @name              B1 Kiosk Mode
// @namespace         http://tampermonkey.net/
// @homepage          https://github.com/martynas2200/b1-labels
// @version           2.1.0
// @description       Simplified kiosk interface for label printing
// @author            Martynas Miliauskas
// @match             https://www.b1.lt/*
// @icon              https://b1.lt/favicon.ico
// @connect           b1.lt
// @connect           raw.githubusercontent.com
// @downloadURL       https://raw.githubusercontent.com/martynas2200/b1-labels/main/dist/kiosk.user.js
// @updateURL         https://raw.githubusercontent.com/martynas2200/b1-labels/main/dist/kiosk.user.js
// @grant             GM.setValue
// @grant             GM.getValue
// @grant             unsafeWindow
// @grant             GM_xmlhttpRequest
// @license           GNU GPLv3
// ==/UserScript==

!function(){"use strict";const e={en:{...{barcode:"Barcode",foundXItems:"{1} items found",multipleItemsFound:"Multiple items found",itemCreated:"Item created",itemNotFound:"Item not found!",itemUpdated:"Item updated",notAllItemsActive:"Not all items are active; Do you want to proceed?",oddNumberOfItems:"Odd number of items; Do you want to proceed?",success:"Success",error:"Error",failed:"Failed",loading:"Loading...",nlabelsToBePrinted:"labels to be printed",noData:"No data to print!",invalidId:"Invalid ID",longTimeAgo:"a long time ago",twoMonthsAgo:"two months ago",oneMonthAgo:"a month ago",threeWeeksAgo:"three weeks ago",twoWeeksAgo:"two weeks ago",daysAgo:"{1} days ago",yesterday:"yesterday",hoursAgo:"{1} hours ago",minutesAgo:"{1} minutes ago"},normal:"Normal",half:"Half",add:"Add",addManufacturer:"Add Manufacturer",addPackageFee:"Add Package Fee",addToList:"Add to List",ageLimit:"Age Limit",ago:"ago",barcodeOnly:"Barcode only",fridge:"Fridge",alcohol:"Alcohol",asMentioned:"As mentioned",attributeName:"Attribute Name",autoLogin:"Instant Login",checked:"Checked",chooseLabelType:"Choose label type",chooseLabelTypeDescription:"Choose the type of label you want to print",cleanAll:"Clean All",close:"Close",code:"Code",cost:"Cost",countryOfOriginName:"Country of Origin Name",date:"Date",defaultSaleService:"Default Sale Service",departmentNumber:"Department",description:"Description",discount:"Discount",discountPointsStatus:"Discount Points Status",discountRate:"Discount Rate",discountStatus:"Discount Status",done:"Done",enterBarcode:"Enter the barcode",enterName:"Enter Name",enterNewPrice:"Enter new price",expiryDate:"Expiry Date",files:"Files",fitRaso:"Fit Raso",freePrice:"Free Price",fullBarcode:"Full Barcode",fullName:"Full Name",grossWeight:"Gross Weight",groupName:"Group Name",help:"If you have any problems, reach out via GitHub",inactiveItem:"The item is inactive. Do you want to continue?",isActive:"Is Active",isCommentRequired:"Is Comment Required",isQuantitative:"Is Quantitative",isRefundable:"Is Refundable",itemAdded:"Item added",itemCatalog:"Item Catalog",itemDetails:"Item Details",itemNotActive:"Item not active",itemsFound:"Items found",kiloPrice:"Price per kilo",label:"Label",labels:"Labels",leftover:"Leftover",login:"Login",loginDetailsNotFound:"Login details not found",manufacturerName:"Manufacturer Name",markdowns:"Markdowns",maxDiscount:"Max Discount",measurementUnitCanBeWeighed:"Measurement Unit Can Be Weighed",measurementUnitName:"Measurement Unit Name",minPriceWithVat:"Min Price With VAT",minQuantity:"Min Quantity",missingBarcode:"Missing barcode",missingName:"Missing name",missingWeight:"Missing weight",modifiedAt:"Last modified",name:"Name",netWeight:"Net Weight",newItem:"New Item",nlabelsToBePrinted:" labels to be printed",no:"No",noItemsScanned:"No items scanned yet",noItemsSelected:"No items selected",notAllItemsActive:"Not all selected items are active. Do you want to continue?",number:"Number",oddNumberOfItems:"Odd number of labels. Do you want to continue?",packageCode:"Package",packageQuantity:"Package Quantity",pcs:"pcs",price:"Price",priceFrom:"Price From",priceMinQuantity:"Price Min Quantity",priceNotSet:"Price not set",pricePerKg:"Price per kg",priceUntil:"Price Until",priceWithoutVat:"Price Without VAT",priceWithVat:"Price With VAT",print:"Print",printJobIsSent:"Print job is sent",quantity:"Quantity",readyForScan:"Ready for scan",recentlyModified:"Recently modified items",recentlySearched:"Recently Searched",refresh:"Refresh",retrievedAt:"Retrieved at",save:"Save",sayOutLoud:"Say out loud",show:"Show",showByDate:"Show by Date",showLoginOptions:"Other ways to login",showMore:"Show More",showStock:"Show Stock",simplifyForm:"Simplify Form",stock:"Stock",type:"Label type",thisIs:"This is",toggleKeyboard:"Toggle Keyboard",tooManyItems:"Too many items",total:"Total",totalPrice:"Total Price",validFrom:"Valid From",validUntil:"Valid Until",vatRate:"VAT Rate",weeklyReports:"Weekly Reports",weight:"Weight",weightedItem:"Weighted item",weightedItemAdded:"Weighted item added",weightLabel:"Weight Label",yes:"Yes",zero:"zero",draft:"Draft",saveDraft:"Save Draft",draftSaved:"Draft saved",printDraft:"Print Draft"},lt:{...{barcode:"Barkodas",foundXItems:"Rasta {1} prekių",multipleItemsFound:"Rasta daugiau negu viena prekė!",itemCreated:"Prekė sukurta",itemNotFound:"Prekė nerasta!",itemUpdated:"Prekė atnaujinta",notAllItemsActive:"Ne visos prekės aktyvios, ar norite tęsti?",oddNumberOfItems:"Nelyginis prekių skaičius, ar norite tęsti?",success:"Sėkmingai atlikta",error:"Įvyko klaida",failed:"Nepavyko",loading:"Kraunama...",nlabelsToBePrinted:"etiketės spausdinimui",noData:"Nepakanka duomenų spausdinimui!",invalidId:"Neteisingas ID",longTimeAgo:"labai seniai",twoMonthsAgo:"prieš du mėnesius",oneMonthAgo:"prieš mėnesį",threeWeeksAgo:"prieš tris savaites",twoWeeksAgo:"prieš dvi savaites",daysAgo:"prieš {1} dienas",yesterday:"vakar",hoursAgo:"prieš {1} valandas",minutesAgo:"prieš {1} minutes"},normal:"Normali",half:"Pusė",fridge:"Trumpa (šaldytuvui)",barcodeOnly:"Tik brūkšninis kodas",add:"Pridėti",ago:"",addManufacturer:"Pridėti gamintoją",addPackageFee:"Pridėti fasavimo maišelį",addToList:"Pridėti į sąrašą",ageLimit:"Amžiaus limitas",alcohol:"Alkoholis",asMentioned:"Kaip minėjau",attributeName:"Atributo pavadinimas",autoLogin:"Prisijungti automatiškai",checked:"Tikrinta prieš",chooseLabelType:"Pasirinkite etiketės tipą",chooseLabelTypeDescription:"Pasirinkite etiketės tipą, kurį norite spausdinti",cleanAll:"Išvalyti",close:"Uždaryti",code:"Kodas",cost:"Savikaina",countryOfOriginName:"Kilmės šalies pavadinimas",date:"Data",defaultSaleService:"Numatytoji pardavimo paslauga",departmentNumber:"S",description:"Aprašymas",discount:"Nuolaida",discountPointsStatus:"Nuolaidų taškų statusas",discountRate:"Nuolaidos dydis",discountStatus:"Nuolaidos statusas",done:"Atlikta",enterBarcode:"Įveskite brūkšninį kodą",enterName:"Įveskite prekės pavadinimą",enterNewPrice:"Įveskite naują kainą",expiryDate:"Galiojimo data",files:"Failai",fitRaso:"Tinkamas RASO importui",freePrice:"Laisva kaina",fullBarcode:"Pilnas brūkšninis kodas",fullName:"Pilnas pavadinimas",grossWeight:"Bendras svoris",groupName:"Grupės pavadinimas",help:"Jei kyla problemų, kreiptis pas Martyną",inactiveItem:"Prekė yra neaktyvi. Ar norite tęsti?",isActive:"Aktyvus",isCommentRequired:"Komentaro reikalavimas",isQuantitative:"Kiekinė",isRefundable:"Grąžinimo galimybė",itemAdded:"Prekė pridėta",itemCatalog:"Prekių žinynas",itemDetails:"Prekės informacija",itemNotActive:"Prekė neaktyvi",kiloPrice:"Kilogramo kaina",label:"Etiketė",labels:"Etiketės",leftover:"Liko",login:"Prisijungimas darbo vietoje",loginDetailsNotFound:"Prisijungimo duomenys nerasti",manufacturerName:"Gamintojo pavadinimas",markdowns:"Nukainavimai",maxDiscount:"Max nuolaida",measurementUnitCanBeWeighed:"Prekė gali būti sveriama",measurementUnitName:"Matavimo vieneto pavadinimas",minPriceWithVat:"Min kaina su PVM",minQuantity:"Min kiekis",missingBarcode:"Trūksta brūkšninio kodo",missingName:"Trūksta pavadinimo",missingWeight:"Trūksta svorio",modifiedAt:"Paskutinis keitimas",name:"Pavadinimas",netWeight:"Neto svoris",newItem:"Nauja prekė",nlabelsToBePrinted:" etiketės bus spausdinamos",no:"Ne",noItemsScanned:"Dar nėra nuskaitytų prekių",noItemsSelected:"Nėra pasirinktų prekių",notAllItemsActive:"Ne visos pasirinktos prekės yra aktyvios. Ar norite tęsti?",number:"Numeris",oddNumberOfItems:"Nelyginis etikečių skaičius. Ar norite tęsti?",packageCode:"Pakuotė",packageQuantity:"Pakuotės kiekis",pcs:"vnt.",price:"Kaina",priceFrom:"Kaina nuo",priceMinQuantity:"Kaina min kiekis",priceNotSet:"Kaina nėra nustatyta",pricePerKg:"Kaina už 1 kg",priceUntil:"Kaina iki",priceWithoutVat:"Kaina be PVM",priceWithVat:"Kaina su PVM",print:"Spausdinti",printJobIsSent:"Spausdinimo užduotis nusiųsta",quantity:"Kiekis",readyForScan:"Pasiruošęs skenavimui",recentlyModified:"Šiandien pakeista",recentlySearched:"Neseniai ieškota",refresh:"Atnaujinti",retrievedAt:"Gauta",save:"Išsaugoti",sayOutLoud:"Sakyti kainas balsu",show:"Rodyti",showByDate:"Rodyti pagal datą",showLoginOptions:"Kiti prisijungimo būdai",showMore:"Rodyti daugiau",showStock:"Rodyti likutį",simplifyForm:"Supaprastinti formą",stock:"Likutis",type:"Etiketės tipas",thisIs:"Tai",toggleKeyboard:"Klaviatūra",tooManyItems:"Per daug prekių",total:"Bendra suma",totalPrice:"Apskaičiuota kaina",validFrom:"Galioja nuo",validUntil:"Galioja iki",vatRate:"PVM tarifas",weeklyReports:"Savaitės ataskaitos",weight:"Svoris",weightedItem:"Sveriama prekė",weightedItemAdded:"Sveriama prekė pridėta",weightLabel:"Svorio etiketė",yes:"Taip",zero:"nulis",draft:"Juodraštis",saveDraft:"Išsaugoti juodraštį",draftSaved:"Juodraštis išsaugotas",printDraft:"Spausdinti juodraštį"}},t="lt"===navigator.language.split("-")[0]?"lt":"en",i=(i,a=[])=>{let n=e[t]?.[i]??e.en[i]??i;return a.forEach(((e,t)=>{n=n.replace(`{${t+1}}`,e)})),n};class a{static injector=null;static getInjector(){if(this.injector)return this.injector;const e=document.querySelector("[ng-app]");if(!e)throw new Error("Angular app not found");return this.injector=angular.element(e).injector(),this.injector}static getService(e){return this.getInjector().get(e)}}class n{notificationService;constructor(){try{this.notificationService=a.getService("Notification")}catch(e){console.error("Failed to get Notification service",e),this.notificationService={info:e=>alert(e),error:e=>alert(e),success:e=>alert(e),warning:e=>alert(e),primary:e=>alert(e)}}}info(e){this.notificationService.info(e)}error(e){this.notificationService.error(e)}success(e){this.notificationService.success(e)}warning(e){this.notificationService.warning(e)}primary(e){this.notificationService.primary(e)}}class s{notification=new n;interfaceInUse=!1;isLoggedIn=!1;admin=!1;user;defaultPermissions={create:!1,read:!1,update:!1,delete:!1};readPermissions={create:!1,read:!0,update:!1,delete:!1};constructor(){this.user=null,this.checkLoginStatus(),unsafeWindow.saveLoginDetails=this.saveLoginDetails.bind(this),unsafeWindow.saveURL=this.saveURL.bind(this)}static getCurrentCompany(){const e=currentCompanyUser?.company?.name;return null==e?"":e}checkLoginStatus(){return null!=currentUser?.name?(this.isLoggedIn=!0,this.user=currentUser,this.admin=null!=this.user&&this.user.typeId<=3,this.admin||this.limitPermissions(),!0):(null!=currentUser&&null==currentUser.name&&(this.isLoggedIn=!1),!1)}limitPermissions(){currentCompanyUser.permissions.crudBankaisaskait={...this.defaultPermissions},currentCompanyUser.permissions.crudKlientai={...this.defaultPermissions},currentCompanyUser.permissions.crudDokSer={...this.defaultPermissions},currentCompanyUser.permissions.crudPardavim={...this.readPermissions},currentCompanyUser.permissions.crudPrekes={...this.readPermissions},currentCompanyUser.permissions["warehouse-tempFiles"].delete=!1}addContainer(){document.querySelectorAll("h5").forEach((e=>{e.remove()}));const e=document.querySelector("form"),t=`\n      <h5 class="header blue">${i("login")}</h5>\n      <div class="form-group text-center">\n      <button class="btn btn-success-2 btn-block " type="button" id="auto-login"><i class="fa fa-sign-in"></i>${i("autoLogin")}</button>\n      <button class="btn-primary btn btn-block margin-top-8" type="button" id="show-login-options">${i("showLoginOptions")}</button>\n      </div>`;return null!==e?(e.insertAdjacentHTML("beforebegin",t),e.style.display="none",!0):(console.error("Form not found!"),!1)}addLoginOptions(){if(!this.addContainer())return!1;const e=document.querySelector("#show-login-options"),t=document.querySelector("#auto-login"),i=document.querySelector("form");return null!==e&&null!==t&&null!==i&&(e.addEventListener("click",(function(){i.style.display="block",e.style.display="none"})),t.addEventListener("click",(()=>{this.autoLogin()})),!0)}async autoLogin(){const e=document.querySelector('input[name="username"]'),t=document.querySelector('input[name="password"]');if(null===e||null===t)return this.notification.error(i("loginDetailsNotFound")),!1;const a=await GM.getValue("username",""),n=await GM.getValue("password","");if(""===a||""===n)return this.notification.error(i("loginDetailsNotFound")),"x"===e.value&&"x"===t.value&&this.saveLoginDetails(),!1;e.value=a,t.value=n,e.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("input",{bubbles:!0}));const s=document.querySelector("form");if(null===s)return this.notification.error(i("error")),!1;let o=s.getAttribute("ng-submit");if(null===o)return this.notification.error("Recaptcha key not found"),!1;const r=o.match(/"([^"]+)"/);return null===r?(this.notification.error("Recaptcha key not found"),!1):(o=r[1],angular.element(s).controller().signIn(o),!0)}async saveLoginDetails(){if(window.confirm("Do you want to save these login details?")){const e=window.prompt("Enter your username"),t=window.prompt("Enter your password");null!=e&&null!=t&&(await GM.setValue("username",e),await GM.setValue("password",t),alert("Login details saved"))}if(!window.confirm("Do you want to save API key?"))return;const e=window.prompt("Enter your API key");null!==e&&(await GM.setValue("api-key",e),alert("API key saved"))}async saveURL(){const e=window.prompt("Enter the URL");null!==e&&(await GM.setValue("url",e),alert("URL saved"))}}function o(e,t){if(null==e||null==t)return 0;const i=e*t;return Math.round(100*(i+Number.EPSILON))/100}function r(e){if(!e)return null;const t=new Date,a=new Date(new Date(e).getTime()-6e4*(new Date).getTimezoneOffset()),n=t.getTime()-a.getTime(),s=Math.floor(n/864e5),o=Math.floor(n/36e5),r=Math.floor(n/6e4);return s>60?null:s>30?i("oneMonthAgo"):s>21?i("threeWeeksAgo"):s>14?i("twoWeeksAgo"):s>1?i("daysAgo",[s.toString()]):1===s?i("yesterday"):o>=1?i("hoursAgo",[o.toString()]):i("minutesAgo",[r.toString()])}function l(e){const t=new Date,i=new Date(e),a=t.getTime()-i.getTime();return Math.floor(a/864e5)<1}class c{modalService;notification;req;weightModal;constructor(e,t,i,a){this.modalService=e,this.notification=t,this.req=i,this.weightModal=a}show(e){const t=Object.fromEntries(Object.entries(e).filter((([e,t])=>null!==t&&!e.toString().toLowerCase().includes("id")&&!e.toString().toLowerCase().includes("account")))),a=Object.entries(t).map((([e,t])=>`\n        <div class="row col-xs-12">\n          <div class="col-sm-5" >${i(e)}:</div>\n          <div class="col-sm-7" ${e.includes("price")?'ng-click="changePrice(item)"':""}>${t}</div>\n        </div>\n      `)).join(""),n=`\n      <div class="modal-header">\n        <h5 class="modal-title inline">${i("itemDetails")}</h5>\n        <button type="button" class="close" aria-label="Close" ng-click="closeModal()">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <div class="container width-auto">${a}</div>\n      </div>\n      <div class="modal-footer">\n        <button class="btn btn-sm btn-pink" type="button" ng-click="tagModal(item)"><i class="fa fa-tag"></i> ${i("label")}</button>\n        <button type="button" class="btn btn-sm" ng-click="closeModal()">${i("close")}</button>\n      </div>\n    `;this.modalService.showModal({template:n,scopeProperties:{item:e,changePrice:e=>{this.req.quickPriceChange(e)},tagModal:e=>{this.weightModal.show(e)}}})}}class d{text;constructor(e){this.text=e}encode(){var e,t,i,a=3,n=[],s=[];for(e=0;e<this.text.length;e++){if(i=this.text.charCodeAt(e),2!=a){for(t=0;t+e<this.text.length&&!(this.text.charCodeAt(e+t)-48>>>0>9);t++);(t>1&&0==e||t>3&&(e+t<this.text.length||!(1&t)))&&(n.push(0==e?105:99),a=2)}if(2==a&&(i-48>>>0<10&&e+1<this.text.length&&this.text.charCodeAt(e+1)-48>>>0<10?n.push(+this.text.substr(e++,2)):a=3),2!=a){if(a>2||(127&i)<32&&a||(127&i)>95&&!a){for(t=a>2?e:e+1;t<this.text.length&&!(this.text.charCodeAt(t)-32&64);t++);t=t==this.text.length||96&this.text.charCodeAt(t)?1:0,n.push(0==e?103+t:t!=a?101-t:98),a=t}i>127&&n.push(101-a),n.push((64+(127&i))%96)}}for(0==e&&n.push(103),t=n[0],e=1;e<n.length;e++)t+=e*n[e];for(n.push(t%103),n.push(106),i=[358,310,307,76,70,38,100,98,50,292,290,274,206,110,103,230,118,115,313,302,295,370,314,439,422,406,403,434,410,409,364,355,283,140,44,35,196,52,49,324,276,273,220,199,55,236,227,59,443,327,279,372,369,375,428,419,395,436,433,397,445,289,453,152,134,88,67,22,19,200,194,104,97,26,25,265,296,477,266,61,158,94,79,242,122,121,466,458,457,367,379,475,188,143,47,244,241,468,465,239,247,431,471,322,328,334,285],a=e=0;e<n.length;e++,a++)for(s[a++]=1,t=256;t>0;t>>=1,a++)i[n[e]]&t&&(s[a]=1);return s[a++]=s[a]=1,[s]}toHtml(e,t=3,i=5){Array.isArray(t)||(t=[t||3,t||3]);let a,n,s="barcode"+t[0]+t[1],o="<style> ."+s+" div {float:left; margin:0; height:"+t[1]+"px}";i=i||5;for(var r=0;r<i;r++)for(var l=0;l<i;l++)o+="."+s+" .bar"+l+r+" {border-left:"+l*t[0]+"px solid; margin-right:"+r*t[0]+"px}";for(o+="</style><div class="+s+" style='line-height:"+t[1]+"px; display:inline-block'>",r=0;r<e.length;r++)for(l=0;l<e[r].length;){for(r&&!l&&(o+="<br style='clear:both' />"),a=0;l<e[r].length&&(e[r][l]&&a+1!=i);a++,l++);for(n=0;l<e[r].length&&(!e[r][l]&&n+1!=i);n++,l++);o+="<div class=bar"+a+n+"></div>"}return o+"</div>"}}class g{items=[];success=!1;type;constructor(e=void 0,t="normal"){this.type=t,null==e||(e instanceof Promise?e.then((e=>{this.items=e,this.print()})):(this.items=e,this.print()))}print(){this.items=this.items.filter((e=>null!=e.barcode)),(this.isAllItemsActive()||confirm(i("notAllItemsActive")))&&("half"!=this.type||this.items.length%2==0||confirm(i("oddNumberOfItems")))&&(this.items.length>0?this.printLabelsUsingBrowser(this.items):alert(i("noData")))}isAllItemsActive(){return this.items.every((e=>e.isActive))}makeUpperCaseBold(e){return e.replace(/("[^"]+"|[A-ZŽĄČĘĖĮŠŲŪ]{3,})/g,"<b>$1</b>")}static getPricePerUnit(e){const t=/(?:,?\s*)?(?:(\d+)\s*x\s*)?(\d+(\.\d+)?(?:,\d+)?)[\s]*(k?g|m?l|vnt|pak|rul)\b/i,i=e.name.match(t);if(i){if(e.name.replace(i[0],"").match(t))return null;const a=i[1]?parseInt(i[1]):1,n=parseFloat(i[2].replace(",","."))*a,s=i[4].replace(".","").toLowerCase();let o;return o="g"===s||"ml"===s?(e.priceWithVat/(n/1e3)).toFixed(2)+("ml"===s?" €/l":" €/kg"):(e.priceWithVat/n).toFixed(2)+" €/"+s,parseFloat(o)===e.priceWithVat?null:o}return null}generateLabel(e,t=this.type){const i=document.createElement("div");return i.className="label",null!=e.weight?this.generateWeightLabel(e,"half"===t):("normal"!==t&&i.classList.add(t),i.appendChild(this.createDivWithClass("item",this.makeUpperCaseBold(e.name),!0)),null!=e.barcode&&"half"!==t?i.appendChild(this.createCode123Div(e)):null!=e.barcode&&i.appendChild(this.createDMDiv(e)),i.appendChild(this.createDivWithClass("price",this.getItemPrice(e))),null!=e.packageCode?i.appendChild(this.createDivWithClass("subtext","Tara +0.10")):1==e.measurementUnitCanBeWeighed&&i.appendChild(this.createDivWithClass("subtext","/ 1 "+e.measurementUnitName)),i)}getItemPrice(e){return null==e.priceWithVat||0===e.priceWithVat?"":"number"==typeof e.priceWithVat?e.priceWithVat.toFixed(2):parseFloat(e.priceWithVat).toFixed(2).toString()}createCode123Div(e){const t=document.createElement("div");t.className="barcode",t.appendChild(this.createDivWithClass("barcode-text",e.barcode));const i=new d(e.barcode),a=document.createElement("p");return a.innerHTML=i.toHtml(i.encode(),"barcodeOnly"==this.type?[1,50]:[1,15]),t.appendChild(a),t}generateWeightLabel(e,t=!1){const i=document.createElement("div");if(null==e.weight||null==e.totalPrice||null==e.priceWithVat||null==e.barcode||e.barcode.length>13)return i;i.className="label weight"+(t?" half":"");const a=[{className:"item",text:e.name},{className:"price",text:t&&e.addPackageFee?(e.totalPrice+.01).toFixed(2):e.totalPrice.toFixed(2)},{className:"weight",text:(e.measurementUnitCanBeWeighed?e.weight.toFixed(3):e.weight.toString())+(t?" "+e.measurementUnitName:"")},{className:"kg-price",text:e.priceWithVat.toFixed(2)+(t?" €/kg":"")},{className:"weight-text",text:e.measurementUnitName},{className:"kg-text",text:"€/"+e.measurementUnitName}];if(e.addPackageFee&&!t&&a.push({className:"package",text:"+ 0,01 (fas. maišelis)"}),a.forEach((({className:e,text:t})=>{i.appendChild(this.createDivWithClass(e,t))})),i.appendChild(this.createDMDiv(e)),null!=e.expiryDate){const t=new Date(e.expiryDate).toLocaleDateString("lt-LT",{month:"2-digit",day:"2-digit"});i.appendChild(this.createDivWithClass("expiry",t))}return 1==e.addManufacturer&&null!=e.manufacturerName&&i.appendChild(this.createDivWithClass("manufacturer",e.manufacturerName)),i}createDivWithClass(e,t,i=!1){const a=document.createElement("div");return a.className=e,i?a.innerHTML=t:a.textContent=t,a}createDMDiv(e){const t=document.createElement("div");if(t.className="barcode dm",null==e.barcode)return t;let i=e.barcode;null!=e.weight&&(i="2200"+"0".repeat(13-e.barcode.length)+e.barcode+"0".repeat(5-e.weight.toFixed(3).length)+e.weight.toFixed(3).replace(".",""));const a="http://www.w3.org/2000/svg",n=document.createElementNS(a,"svg"),s=document.createElementNS(a,"path");return s.setAttribute("transform","scale(1)"),n.appendChild(s),s.setAttribute("d",(e=>{var t,i,a="";for(e.forEach((function(e){e.unshift(0)})),e.push([]),e.unshift([]);;){for(i=0;i+2<e.length&&!((t=e[i+1].indexOf(1)-1)>=0||(t=e[i+1].indexOf(5)-1)>=0);i++);if(i+2==e.length||a.length>1e7)return a;for(var n=e[i+1][t+1]>>2,s="",o=t,r=i,l=1;s.length<1e6;){do{t+=2*l-1}while((e[i][t+l]^e[i+1][t+l])&e[i+l][t+l]&1);l^=1&e[i+l][t+l];do{e[l?++i:i--][t+1]^=2}while((e[i+l][t]^e[i+l][t+1])&e[i+l][t+1-l]&1);if(t==o&&i==r)break;l^=1^1&e[i+l][t+1-l],n?s="V"+i+"H"+t+s:s+="H"+t+"V"+i}for(a+="M"+t+" "+i+s+(n?"V"+i:"H"+t)+"Z",l=0,i=1;i<e.length-1;i++)for(t=1;t<e[i].length;t++)l^=e[i][t]>>1&1,e[i][t]=5*l^5&e[i][t]}})(((e,t=!1)=>{var i=[],a=0,n=0;function s(e){a=40*a+e,2==n++&&(i.push(++a>>8),i.push(255&a),n=a=0)}var o,r,l,c=[function(e){return(e-48&255)<10?6:e<128?12:24},function(e){return(e-48&255)<10||(e-65&255)<26||32==e?8:e<128?16:16+c[1](127&e)},function(e){return(e-48&255)<10||(e-97&255)<26||32==e?8:e<128?16:16+c[2](127&e)},function(e){return(e-48&255)<10||(e-65&255)<26||32==e||13==e||62==e||42==e?8:1e9},function(e){return e>=32&&e<95?9:1e9},function(e){return 12}],d=[0,24,24,24,21,25],g=[0,12,12,12,12,25],h=0,m=0,u=[];for(u[e.length]=g.slice(),l=e.length;l-- >0;){for(o=1e9,r=0;r<g.length;r++)g[r]+=c[r](e.charCodeAt(l)),o=Math.min(o,12*Math.ceil(g[r]/12));for(c[0](e.charCodeAt(l))>6&&(g[0]=12*Math.ceil(g[0]/12)),r=0;r<g.length;r++)o+d[r]<g[r]&&(g[r]=o+d[r]);u[l]=g.slice()}for(l=0;;h=m){if(o=u[l][h]-d[h],l+[0,2,2,2,3,0][h]>=e.length)m=0;else for(r=c.length;r-- >0;)12*Math.ceil((u[l+1][r]+c[r](e.charCodeAt(l)))/12)==o&&(m=r);if(h!=m&&h>0)if(h<4)i.push(254);else if(4==h)i.push(31|255&a);else for(n>249&&i.push(n/250+250+149*(i.length+1)%255&255),i.push(n%250+149*(i.length+1)%255+1&255);n>0;n--)i.push(e.charCodeAt(l-n)+149*(i.length+1)%255+1&255);if(l>=e.length)break;if(h!=m&&(a=n=0),h!=m&&m>0&&i.push([230,239,238,240,231][m-1]),0==m)(r=(o=e.charCodeAt(l++))-48&255)<10&&l<e.length&&(e.charCodeAt(l)-48&255)<10?i.push(10*r+e.charCodeAt(l++)-48+130):(o>127&&i.push(235),i.push(1+(127&o))),(4==h||n<0)&&n--;else if(m<4){var p=[[31,0,32,119,47,133,57,179,64,173,90,207,95,277,127,386,255,1],[31,0,32,119,47,133,57,179,64,173,90,258,95,277,122,335,127,386,255,1],[13,55,32,119,42,167,57,179,62,243,90,207,255,3]][m-1];do{for((o=e.charCodeAt(l++))>127&&(s(1),s(30),o&=127),r=0;o>p[r];r+=2);(3&p[r+1])<3&&s(3&p[r+1]),s(o-(p[r+1]>>2))}while(n>0)}else if(4==m){for(n>0&&i.push(255&a+(63&e.charCodeAt(l++))),a=n=0;n<3;n++)a=64*(a+(63&e.charCodeAt(l++)));i.push(a>>16),i.push(a>>8&255)}else l++,n++}var b,f,y,M,I,A,w,v,T=i.length,k=1,N=1,x=-1,D=1;if((-1==n||h&&h<5)&&(m=1),t&&T-m<50){v=[16,7,28,11,24,14,32,18,32,24,44,28];do{I=(f=v[++x])*(b=6+(12&x))/8}while(I-v[++x]<T-m);f>25&&(k=2)}else{f=b=6,r=2,v=[5,7,10,12,14,18,20,24,28,36,42,48,56,68,84,112,144,192,224,272,336,408,496,620];do{if(++x==v.length)return[];f>11*r&&(r=4+r&12),I=(f=b+=r)*b>>3}while(I-v[x]<T-m);f>27&&(N=k=2*Math.floor(f/54)+2),I>255&&(D=2*(I>>9)+2)}for(I-(w=v[x])+1==T&&m>0&&(T--,-1==n&&(i[T-1]^=31^i[T]-1&63)),y=f/k,M=b/N,T<I-w&&(i[T++]=129);T<I-w;)i[T++]=(149*T%253+130)%254;w/=D;var C=new Array(70),S=new Array(70),z=new Array(256),L=new Array(255);for(x=1,r=0;r<255;r++)L[r]=x,z[x]=r,(x+=x)>255&&(x^=301);for(C[w]=0,r=1;r<=w;r++)for(C[x=w-r]=1;x<w;x++)C[x]=C[x+1]^L[(z[C[x]]+r)%255];for(o=0;o<D;o++){for(r=0;r<=w;r++)S[r]=0;for(r=o;r<T;r+=D)for(x=0,v=S[0]^i[r];x<w;x++)S[x]=S[x+1]^(v?L[(z[C[x]]+z[v])%255]:0);for(r=0;r<w;r++)i[T+o+r*D]=S[r]}var E=Array(b+2*N).fill(null).map((function(){return[]}));for(r=0;r<f+2*k;r+=y+2)for(x=0;x<b;x++)E[x+2*(x/M|0)+1][r]=1,1&~x||(E[x+2*(x/M|0)][r+y+1]=1);for(r=0;r<b+2*N;r+=M+2)for(x=0;x<f+2*k;x++)E[r+M+1][x]=1,1&x||(E[r][x]=1);for(w=2,o=0,A=4,r=0;r<I;A-=w,o+=w){if(A==b-3&&-1==o)v=[f,6-b,f,5-b,f,4-b,f,3-b,f-1,3-b,3,2,2,2,1,2];else if(A!=b+1||1!=o||7&f||6!=(7&b)){if(0==A&&o==f-2&&3&f)continue;if(A<0||o>=f||A>=b||o<0)for(A+=2+(w=-w)/2,o+=2-w/2;A<0||o>=f||A>=b||o<0;)A-=w,o+=w;if(A==b-2&&0==o&&3&f)v=[f-1,3-b,f-1,2-b,f-2,2-b,f-3,2-b,f-4,2-b,0,1,0,0,0,-1];else if(A==b-2&&0==o&&4==(7&f))v=[f-1,5-b,f-1,4-b,f-1,3-b,f-1,2-b,f-2,2-b,0,1,0,0,0,-1];else{if(!(1!=A||o!=f-1||7&f||6!=(7&b)))continue;v=[0,0,-1,0,-2,0,0,-1,-1,-1,-2,-1,-1,-2,-2,-2]}}else v=[f-2,-b,f-3,-b,f-4,-b,f-2,-1-b,f-3,-1-b,f-4,-1-b,f-2,-2,-1,-2];for(T=i[r++],x=0;T>0;x+=2,T>>=1)if(1&T){var O=o+v[x],P=A+v[x+1];O<0&&(O+=f,P+=4-(f+4&7)),P<0&&(P+=b,O+=4-(b+4&7)),E[P+2*(P/M|0)+1][O+2*(O/y|0)+1]=1}}for(r=f;3&r;r--)E[r][r]=1;return E})(i))),n.setAttribute("class","datamatrix"),n.setAttribute("viewBox","0 0 18 18"),t.appendChild(n),t}isItInAppMode(){return window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: fullscreen)").matches}async printLabelsUsingBrowser(e){const t=e.map((e=>this.generateLabel(e))),a=window.open("","_blank",this.isItInAppMode()?"width=250,height=300":"width=800,height=600");null!=a?(a.document.title=`${t.length} ${i("nlabelsToBePrinted")}`,a.document.head.appendChild(this.createStyleElement()),t.forEach((e=>{a.document.body.appendChild(e)})),this.success=!0,a.addEventListener("afterprint",(()=>{a.close()})),a.print()):alert("Please allow popups for this site")}createStyleElement(){const e=document.createElement("style");return e.innerHTML="\ufeff.is_a_bug{display:none}@media print{body{margin:0;padding:0;max-width:58.3mm;display:inline-flex;flex-wrap:wrap}}.label{all:revert;position:relative;background:#fff;color:#000;height:31.75mm;width:57.15mm;border:.5px solid #ffdfd4;margin:0px;box-sizing:border-box;overflow:hidden}.item{height:19mm;overflow:hidden;padding:4px;font-family:Arial,sans-serif;font-size:initial;line-height:initial}.barcode{white-space:nowrap;position:absolute;bottom:0;z-index:3}.barcode div{font-size:10px;font-family:monospace;margin-left:6px;line-height:1em}.barcode p{margin:0}.dm{width:6mm;height:6mm;transform:rotate(270deg);padding:3px;fill:#000}.subtext{position:absolute;right:2px;bottom:3px;font-family:serif;font-size:18px;font-weight:500;z-index:10;line-height:1em}.price{position:absolute;bottom:21px;font-size:50px;right:0;overflow:hidden;object-position:center;margin-right:3px;line-height:1em;font-family:\"Book Antiqua\",serif;padding:0px 10px}.price-per-unit{color:#777}.barcodeOnly .item{font-size:.9em;margin-right:15px}.barcodeOnly .barcode{left:50%;transform:translateX(-50%) scale(1.4);width:max-content}.barcodeOnly .barcode>div{margin-left:0;font-size:8px;writing-mode:vertical-lr;position:absolute;right:-1.2em;bottom:1.2em}.barcodeOnly .price,.barcodeOnly .price-per-unit,.barcodeOnly .subtext{display:none}.label.fridge::before{content:\"\";display:block;position:absolute;border-top:.5px dashed #ff9b79;width:100%;bottom:7mm}.label.fridge .item{font-size:15px;height:12mm}.label.fridge .barcode p,.label.fridge .price-per-unit{display:none}.label.fridge .subtext{font-family:\"Book Antiqua\",serif;font-size:1em;bottom:11mm;left:0;right:unset;background:#888;color:#fff;padding:0px 3px;margin-left:6px;border-radius:3px;padding-top:2px}.label.fridge .price,.label.fridge .barcode{bottom:8mm;line-height:.9em}.label.half{width:28.575mm;display:block;border-right:.5px dashed #ff9b79}.label.half+.label.half:nth-of-type(even){border-right-style:solid;border-left-style:none}.label.half .item{font-size:.75em;font-size:12px;text-align:center}.label.half .subtext{padding:0px 3px;border-radius:3px;font-size:.95em}.label.half .price{right:0;left:0;margin:0px 3px;padding:0px;text-align:center;font-size:38px}.label.half .barcode div{font-size:8px;margin:0px;padding:0px;bottom:0}.label.half .barcode p{display:none}.label.weight{display:grid;grid-template-columns:min-content 1fr;align-items:center;justify-content:space-between;padding:5px;box-sizing:border-box;writing-mode:vertical-rl;grid-column-gap:2px;grid-row-gap:0px;font-family:\"Arial\"}.label.weight .barcode{grid-column:1;position:static;width:8mm;height:8mm;transform:unset}.label.weight .item{grid-column:span 2;text-align:left;font-size:11pt;font-size:10pt;max-width:60pt;padding:0px;height:unset}.label.weight .price{all:revert;grid-row:2;grid-column:span 2;text-align:center;justify-self:center;align-self:end;font-size:16pt;font-weight:bold;line-height:1em;font-family:\"Book Antiqua\",serif;margin-right:4px}.label.weight .price::after{content:\"  €\"}.label.weight .kg-price{grid-column:2;justify-self:center;align-self:end}.label.weight .kg-text{grid-column:2}.label.weight .kg-text,.label.weight .weight-text{justify-self:center;align-self:baseline;color:#999;font-size:.8em;line-height:.6}.label.weight .weight-text{grid-column:1}.label.weight .weight{grid-column:1;justify-self:center;align-self:end}.label.weight .expiry{grid-column:2;text-align:center;justify-self:center;align-self:center;line-height:.9;font-size:.8em;color:#000}.label.weight .expiry::before{content:\"Geriausia iki \";color:#444;display:inline;font-family:Arial}.label.weight.half{display:grid;writing-mode:unset}.label.weight.half .price{font-size:18px}.label.weight.half *:not(.price){font-size:9pt}.label.weight.half .item{max-width:unset;max-height:11mm}.label.weight.half .dm{grid-row:3/span 3}.label.weight.half .weight{grid-column:2}.label.weight.half .expiry::before{content:\" \";display:inline-block;position:static;background-repeat:no-repeat;background-image:url(\"data:image/svg+xml,%3Csvg fill='%23000000' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='15px' height='15px' viewBox='0 0 612 612' xml:space='preserve'%3E%3Cg%3E%3Cg%3E%3Cpath d='M612,463.781c0-70.342-49.018-129.199-114.75-144.379c-10.763-2.482-21.951-3.84-33.469-3.84 c-3.218,0-6.397,0.139-9.562,0.34c-71.829,4.58-129.725,60.291-137.69,131.145c-0.617,5.494-0.966,11.073-0.966,16.734 c0,10.662,1.152,21.052,3.289,31.078C333.139,561.792,392.584,612,463.781,612C545.641,612,612,545.641,612,463.781z M463.781,561.797c-54.133,0-98.016-43.883-98.016-98.016s43.883-98.016,98.016-98.016s98.016,43.883,98.016,98.016 S517.914,561.797,463.781,561.797z'/%3E%3Cpolygon points='482.906,396.844 449.438,396.844 449.438,449.438 396.844,449.438 396.844,482.906 482.906,482.906 482.906,449.438 482.906,449.438 '/%3E%3Cpath d='M109.969,0c-9.228,0-16.734,7.507-16.734,16.734v38.25v40.641c0,9.228,7.506,16.734,16.734,16.734h14.344 c9.228,0,16.734-7.507,16.734-16.734V54.984v-38.25C141.047,7.507,133.541,0,124.312,0H109.969z'/%3E%3Cpath d='M372.938,0c-9.228,0-16.734,7.507-16.734,16.734v38.25v40.641c0,9.228,7.507,16.734,16.734,16.734h14.344 c9.228,0,16.734-7.507,16.734-16.734V54.984v-38.25C404.016,7.507,396.509,0,387.281,0H372.938z'/%3E%3Cpath d='M38.25,494.859h236.672c-2.333-11.6-3.572-23.586-3.572-35.859c0-4.021,0.177-7.999,0.435-11.953H71.719 c-15.845,0-28.688-12.843-28.688-28.688v-229.5h411.188v88.707c3.165-0.163,6.354-0.253,9.562-0.253 c11.437,0,22.61,1.109,33.469,3.141V93.234c0-21.124-17.126-38.25-38.25-38.25h-31.078v40.641c0,22.41-18.23,40.641-40.641,40.641 h-14.344c-22.41,0-40.641-18.231-40.641-40.641V54.984H164.953v40.641c0,22.41-18.231,40.641-40.641,40.641h-14.344 c-22.41,0-40.641-18.231-40.641-40.641V54.984H38.25C17.126,54.984,0,72.111,0,93.234v363.375 C0,477.733,17.126,494.859,38.25,494.859z'/%3E%3Ccircle cx='134.774' cy='260.578' r='37.954'/%3E%3Ccircle cx='248.625' cy='260.578' r='37.954'/%3E%3Ccircle cx='362.477' cy='260.578' r='37.954'/%3E%3Ccircle cx='248.625' cy='375.328' r='37.953'/%3E%3Ccircle cx='134.774' cy='375.328' r='37.953'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");height:15px;width:15px}.label.weight.half .expiry{display:flex;align-items:center}.label.weight.half .manufacturer,.label.weight.half .weight-text,.label.weight.half .kg-text,.label.weight.half .package{display:none}.label.weight .manufacturer,.label.weight .description{font-size:.7em;grid-column:span 2}.label.weight .package{font-size:.7em;grid-column:span 2}.label.weight .package{grid-row:3;grid-column:span 2;text-align:center;justify-self:center;align-self:center;margin-right:-5px;margin-left:5px;color:#444;font-size:10px;line-height:.8em}del{color:gray;position:relative;text-decoration:none;position:absolute;bottom:0;right:5px;font-size:1.4em;line-height:1em}del:after{content:\"\";display:block;position:absolute;width:110%;height:2px;border-radius:1px;background:darkred;top:9px;left:-5%;transform:skewY(-14deg)}",e}}class h{$uibModal;$rootScope;modalInstance=null;constructor(){const e=angular.element(document.body).injector();this.$uibModal=e.get("$uibModal"),this.$rootScope=e.get("$rootScope")}async showModal(e){const t=this.$rootScope.$new(!0);return e.scopeProperties&&Object.defineProperties(t,Object.entries(e.scopeProperties).reduce(((t,[i,a])=>({...t,[i]:{get:()=>e.scopeProperties[i],set:t=>e.scopeProperties[i]=t,enumerable:!0,configurable:!0}})),{})),this.modalInstance=this.$uibModal.open({animation:!0,template:e.template,scope:t,size:e.size||"lg",backdrop:e.backdrop||"static",windowClass:e.windowClass||""}),t.closeModal=()=>{this.modalInstance.close(),t.$destroy(),e.onClose?.()},this.modalInstance.result}}class m{notifier;items={};baseUrl="https://www.b1.lt";path="/reference-book/items/search";csrfToken;headers;turnstileService;constructor(e){this.notifier=e,this.turnstileService=a.getService("turnstileService");const t=document.querySelector('meta[name="csrf-token"]');this.csrfToken=null!=t?t.content:"",this.headers={accept:"application/json, text/plain, */*","accept-language":"en-GB,en;q=0.9,lt-LT;q=0.8,lt;q=0.7,en-US;q=0.6","content-type":"application/json;charset=UTF-8",origin:this.baseUrl,referer:this.baseUrl,"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest","x-csrf-token":this.csrfToken,cookie:""}}buildRequestBody(e,t=20){return{pageSize:t,filters:{groupOp:"AND",rules:e},allSelected:!1,asString:"",page:1}}async fetchData(e,t,a){if(""===this.csrfToken)return console.error("CSRF token is missing"),void this.notifier.error("CSRF token is missing");const n=t.split("/");n.pop(),this.headers.referer=`${this.baseUrl}${n.join("/")}`,this.getCookies();try{const n=await fetch(`${this.baseUrl}${t}`,{method:e,headers:this.headers,body:JSON.stringify(a)});if(n.ok)return await n.json();if("challenge"===n.headers.get("cf-mitigated")||403===n.status){if(await this.handleChallenge())return console.info("Challenge handled, repeat the request"),await this.fetchData(e,t,a)}else console.error("Request failed with status:",n.status),this.notifier.error({title:i("error"),message:n.statusText})}catch(e){console.error("Error:",e),this.notifier.error("Error: "+e)}}getCookies(){document.cookie.split(";").map((e=>e.trim())).forEach((e=>{const[t,i]=e.split("=");["YII_CSRF_TOKEN","b1-device_id","b1-session_id","b1-use-cookies","b1-wss_srv","b1-ref_url","cf_clearance","_ga"].includes(t.trim())&&(this.headers.cookie=this.headers.cookie.length>0?`${this.headers.cookie}; ${t}=${i}`:`${t}=${i}`)}))}isItDigits(e){return/^\d+$/.test(e)}async getItem(e){if(!this.isItDigits(e))return this.notifier.error("Invalid barcode"),null;if(Object.keys(this.items).includes(e)){const t=this.items[e].retrievedAt;if(null!=t&&e.length>10&&(new Date).getTime()-t.getTime()<3e4)return{...this.items[e]};if(null!=t&&e.length<10&&(new Date).getTime()-t.getTime()<6e4)return{...this.items[e]}}const t={barcode:{data:e,field:"barcode",op:"0"===e[0]?"cn":"eq"}},a=this.buildRequestBody(t),n=await this.fetchData("POST",this.path,a);return null==n||null==n.data[0]?null:(n.data[0].retrievedAt=new Date,this.items[e]=n.data[0],n.data.length>1&&this.notifier.warning({title:i("multipleItemsFound"),delay:2e4,message:i("foundXItems",[n.records])}),n.data[0])}async getRecentlyModifiedItems(e=!1){const t=new Date;t.setHours(0,0,0,0);const a=this.buildRequestBody({isActive:{data:!0,field:"isActive",op:"eq"},modifiedAt:{data:t.toISOString().split("T")[0],field:"modifiedAt",op:"gt"}},20);a.sort={modifiedAt:"desc"};const n=await this.fetchData("POST",this.path,a),s=JSON.parse(localStorage.getItem("items")??"[]"),o=new Date;return n&&n.data&&n.data.forEach((e=>{e.retrievedAt=o,this.items[e.barcode]=e;const t=s.find((t=>t.barcode===e.barcode));t&&t.printedAt&&e.modifiedAt&&new Date(e.modifiedAt).getTime()<=new Date(t.printedAt).getTime()&&(e.noNeedToPrint=!0)})),e&&this.notifier.info(i("foundXItems",[n.records])),n.data||[]}async getItemsByIds(e){const t={id:{data:e,field:"id",op:"in"}},a=this.buildRequestBody(t,20),n=await this.fetchData("POST",this.path,a);return n&&n.data&&n.data.forEach((e=>{e.retrievedAt=new Date,this.items[e.barcode]=e})),200===n.code?this.notifier.success({title:i("success"),message:i("foundXItems",[n.records])}):this.notifier.error({title:i("error"),message:n.message}),n.data||[]}async getItemMovements(e,t,a){const n={itemId:{data:e,field:"itemId",op:"eq"},warehouseId:{data:a,field:"warehouseId",op:"eq"},date:{data:t,field:"date",op:"eq"}},s=this.buildRequestBody(n,20);s.sort={};const o=await this.fetchData("POST","/warehouse/item-movement/search",s);return 200===o.code?this.notifier.success({title:i("success"),message:i("foundXItems",[o.records])}):this.notifier.error({title:i("error"),message:o.message}),o.data||[]}async saveItem(e,t){if(!this.isItDigits(e))return this.notifier.error(i("invalidId")),!1;const a=await this.fetchData("POST",`/reference-book/items/update?id=${e}`,t);return 200===a.code?this.notifier.success({title:i("itemUpdated"),message:i("newPriceIs")+" "+t.priceWithVat,delay:15e3}):this.notifier.error({title:i("failedToUpdateItem"),message:a.message}),200===a.code}async quickPriceChange(e){const t=prompt(i("enterNewPrice"),(e.priceWithVat??0).toString());if(null==t||null==e.id)return this.notifier.info(i("error")),!1;const a=new Object;return a.isActive=!0,a.id=e.id,a.priceWithVat=parseFloat(t.replace(",",".")),a.priceWithVat<=0?(this.notifier.error(i("missingPrice")),!1):(a.priceWithoutVat=a.priceWithVat/1.21,a.priceWithoutVat=Math.round(1e4*(a.priceWithoutVat+Number.EPSILON))/1e4,e.priceWithVat=a.priceWithVat,e.priceWithoutVat=a.priceWithoutVat,this.saveItem(a.id,a))}async createItem(e){const t=await this.fetchData("POST","/reference-book/items/create",e);return 200===t.code?(this.notifier.success(i("itemCreated")),setTimeout((()=>{this.saveItem(t.data.id,{isActive:!0})}),400)):this.notifier.error({title:i("failedToCreateItem"),message:t.message}),200===t.code}async getSales(e){const t={operationTypeName:{data:e,field:"operationTypeName",op:"cn"}},i=this.buildRequestBody(t,20);i.sort={saleDate:"desc"};return this.fetchData("POST","/warehouse/light-sales/search",i)}getSaleItems(e){const t={lightSaleId:{field:"lightSaleId",op:"eq",data:e}},i=this.buildRequestBody(t,-1);return this.fetchData("POST","/warehouse/light-sale-items/search",i)}async handleChallenge(){try{return await this.turnstileService.render(),console.info("Turnstile challenge passed!"),!0}catch(e){return console.error("Turnstile challenge failed.",e),!1}}}class u{language;notifier;apiKey=null;numbers;languages={"lt-LT":{units:["","vienas","du","trys","keturi","penki","šeši","septyni","aštuoni","devyni"],teens:["dešimt","vienuolika","dvylika","trylika","keturiolika","penkiolika","šešiolika","septyniolika","aštuoniolika","devyniolika"],tens:["","","dvidešimt","trisdešimt","keturiasdešimt","penkiasdešimt","šešiasdešimt","septyniasdešimt","aštuoniasdešimt","devyniasdešimt"],hundreds:["","šimtas","du šimtai","trys šimtai","keturi šimtai","penki šimtai","šeši šimtai","septyni šimtai","aštuoni šimtai","devyni šimtai"]},"en-GB":{units:["","one","two","three","four","five","six","seven","eight","nine"],teens:["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],tens:["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],hundreds:["","one hundred","two hundred","three hundred","four hundred","five hundred","six hundred","seven hundred","eight hundred","nine hundred"]}};constructor(e){this.language=window.navigator.language.split("-")[0],"lt"==this.language?this.language="lt-LT":this.language="en-GB",this.numbers=this.languages[this.language],this.notifier=e,this.checkApiKey()}async checkApiKey(){this.apiKey=await GM.getValue("api-key",null),null!=this.apiKey&&this.apiKey.length<20&&(this.apiKey=null,this.notifier.error(i("invalidApiKey")))}async speak(e){new Audio(await this.getAudioUrl(e)).play()}async getAudioUrl(e){if(null==this.apiKey)return;const t=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:this.language,ssmlGender:"MALE"},audioConfig:{audioEncoding:"MP3"}})}),a=await t.json();if(null==a.audioContent)return void this.notifier.error({title:i("error"),message:JSON.stringify(a)});const n=a.audioContent,s=new Blob([Uint8Array.from(atob(n),(e=>e.charCodeAt(0)))],{type:"audio/mp3"});return URL.createObjectURL(s)}numberToWords(e){let t=[];if(0===e)t.push(i("zero"));else{const i=e%10,a=Math.floor(e/10)%10,n=Math.floor(e/100);n>0&&t.push(this.numbers.hundreds[n]),a>1&&t.push(this.numbers.tens[a]),1===a?t.push(this.numbers.teens[i]):t.push(this.numbers.units[i])}return t=t.filter((e=>e)),t.join(" ")}digitsToPrice(e){const t=Math.floor(e),i=Math.round(100*(e-t));let a=[];return t>0&&a.push(this.numberToWords(t)),i>0&&(0!==t&&"lt-LT"==this.language?(1===t||t%10==1&&t%100!=11?a.push("euras"):t%10==0||t%10>=10||t%100>=10&&t%100<=20?a.push("eurų"):a.push("eurai"),a.push("ir")):t>1&&"en-GB"==this.language?a.push("euros"):1===t&&"en-GB"==this.language&&a.push("euro"),a.push(this.numberToWords(i)),"en-GB"==this.language&&1===i?a.push("cent"):"en-GB"==this.language?a.push("cents"):1===i||i%10==1&&i%100!=11?a.push("centas"):i%10==0||i%10>=10||i%100>=10&&i%100<=20?a.push("centų"):a.push("centai")),a=a.filter((e=>e)),a.join(" ")}}class p{modalService;notifier;controller;modalScope;constructor(e,t,a){this.modalService=e,this.notifier=t,this.controller=a,this.modalScope={item:null,weight:"",virtualKeyboardVisible:void 0!==this.controller,addButton:void 0!==this.controller,hideVirtualKeyboard:this.hideVirtualKeyboard.bind(this),handleWeightChange:this.handleWeightChange.bind(this),key:this.key.bind(this),add:this.add.bind(this),print:this.print.bind(this),picker:this.showPicker.bind(this),i18n:i}}hideVirtualKeyboard(){this.modalScope.virtualKeyboardVisible=!1}key(e){this.modalScope.item&&("d"===e&&this.modalScope.item.weight?this.modalScope.item.weight=this.modalScope.item.weight.toString().slice(0,-1):"c"===e?this.modalScope.item.weight="":"d"!==e&&(this.modalScope.item.weight=(this.modalScope.item.weight||"")+e),this.modalScope.handleWeightChange())}show(e){return e&&e.name&&e.priceWithVat?(this.setupModalItem(e),this.modalService.showModal({template:' <div class="modal-header"> <button type="button" class="close" ng-click="closeModal()" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> <h4 class="modal-title" id="weightLabelModalLabel">{{ !item.measurementUnitCanBeWeighed ? i18n(\'label\') : i18n(\'weightLabel\')}}</h4> </div> <div class="modal-body {{ item.weight > 9999 ? \'background-white-red\' : \'\' }}"> <div class="form"> <div class="form-group"> <label for="productName">{{i18n(\'name\')}}</label> <input type="text" class="form-control" ng-model="item.name" readonly> </div> <div class="row"> <div class="form-group col-sm-4"> <label for="productWeight" >{{ (!item.measurementUnitCanBeWeighed ? i18n(\'quantity\') : i18n(\'weight\') + \' (g)\')}}</label> <input type="text" class="form-control" ng-model="item.weight" ng-keyup="handleWeightChange(item.weight)" ng-keydown="hideVirtualKeyboard()"> </div> <div class="form-group col-sm-4"> <label for="totalPrice">{{i18n(\'totalPrice\')}} (€)</label> <input type="number" step="0.01" class="form-control" readonly ng-model="item.totalPrice" > </div> <div class="form-group col-sm-4"> <label for="kgPrice">{{ i18n(\'price\') + \' 1 \' + item.measurementUnitName }} (€)</label> <input type="number" step="0.01" class="form-control" readonly ng-model="item.priceWithVat"> </div> </div> <div class="row"> <div class="col-sm-6"> <div class="form-group"> <label for="expiryDate">{{i18n(\'expiryDate\')}}</label> <input type="date" class="form-control" ng-model="item.expiryDate" ng-click="picker($event)"> </div> <div class="form-group"> <div class="checkbox-form"> <label> <input type="checkbox" class="ace" ng-model="item.addManufacturer"> <span class="lbl display-inline">&nbsp;{{i18n(\'addManufacturer\')}}&nbsp; {{ item.manufacturerName }}</span> </label> </div> <div class="checkbox-form"> <label> <input type="checkbox" class="ace" ng-model="item.addPackageFee" checked> <span class="lbl display-inline">&nbsp;{{i18n(\'addPackageFee\')}}</span> </label> </div> </div> </div> <div class="col-sm-6" ng-show="virtualKeyboardVisible"> <div class="keyboard"> <button class="key btn" ng-click="key(\'7\')">7</button> <button class="key btn" ng-click="key(\'8\')">8</button> <button class="key btn" ng-click="key(\'9\')">9</button> <button class="key btn" ng-click="key(\'4\')">4</button> <button class="key btn" ng-click="key(\'5\')">5</button> <button class="key btn" ng-click="key(\'6\')">6</button> <button class="key btn" ng-click="key(\'1\')">1</button> <button class="key btn" ng-click="key(\'2\')">2</button> <button class="key btn" ng-click="key(\'3\')">3</button> <button class="key btn" ng-click="key(\'0\')">0</button> <button class="key btn btn-grey" ng-click="key(\'c\')">C</button> <button class="key btn btn-danger backspace" ng-click="key(\'d\')">⌫</button> </div> </div> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" ng-click="closeModal()"> <i class="fa fa-times"></i>&nbsp;{{i18n(\'close\')}}</button> <button type="button" class="btn btn-primary" ng-click="add()" ng-if="addButton"> <i class="fa fa-plus"></i>&nbsp;{{i18n(\'add\')}}</button> <button type="button" class="btn btn-purple" ng-click="print()" "> <i class="fa fa-print"></i>&nbsp;{{i18n(\'print\')}}&nbsp;[{{ i18n(\'normal\')}}]</button> </div>',scopeProperties:this.modalScope,size:"md",windowClass:"weight-label-modal"})):(this.notifier.error(i("noData")),Promise.reject())}setupModalItem(e){this.modalScope.item={...e,weight:"",addManufacturer:!1,addPackageFee:!0}}getWeightItem(){const e={...this.modalScope.item};return e&&e.weight?(e.weight=e.measurementUnitCanBeWeighed?this.gToKg(parseFloat(e.weight.toString())):parseFloat(e.weight.toString()),e.weight>9.999?(this.notifier.error(i("maxWeight")),null):(e.addManufacturer=!!e.addManufacturer&&!!e.manufacturerName?.length,e)):(this.notifier.error(i("missingWeight")),null)}add(){if(void 0!==this.controller){const e=this.getWeightItem();e&&this.controller?.processItem(e,!0)}}print(){const e=this.getWeightItem();e&&(this.notifier.success({title:i("printJobIsSent"),message:`${e.weight}${e.measurementUnitName}`}),new g([e]))}handleWeightChange(){this.modalScope.item&&(this.modalScope.item.totalPrice=o(this.modalScope.item.priceWithVat,this.modalScope.item.measurementUnitCanBeWeighed?this.gToKg(Number(this.modalScope.item.weight||0)):Number(this.modalScope.item.weight||0)))}gToKg(e){return e/1e3}showPicker(e){const t=e.target;t?.showPicker&&t.showPicker()}}class b{type;modal;lg;labelTypes=["normal","fridge","half","barcodeOnly"];fakeItems=[{name:"Whiskey BLACK RAM, 40%, 0,7 l",barcode:"3800032070302",measurementUnitName:"vnt.",measurementUnitCanBeWeighed:!1,priceWithVat:14.29,isActive:!0,isRefundable:!0},{name:"Cookies BARNI Milk, 30 g",barcode:"5906747318345",measurementUnitName:"vnt.",measurementUnitCanBeWeighed:!1,priceWithVat:.5,isActive:!0,isRefundable:!0},{name:"Coca-Cola, 0,5 l",barcode:"4779036770016",measurementUnitName:"vnt.",measurementUnitCanBeWeighed:!1,priceWithVat:1.99,isActive:!0,packageCode:"1100",isRefundable:!0}];constructor(e){this.type=e,this.modal=new h,this.lg=new g}open(){return new Promise(((e,t)=>{this.modal.showModal({template:this.lg.createStyleElement().outerHTML+'\n        <div class="modal-header">\n          <button type="button" class="close" ng-click="closeModal()">\n            <span>&times;</span>\n          </button>\n          <h4 class="modal-title">{{ i18n(\'chooseLabelType\') }}</h4>\n        </div>\n        <div class="modal-body">\n          <div class="alert-xs alert-info">{{ i18n(\'chooseLabelTypeDescription\') }}</div>\n          <div class="list-group">\n            <div class="list-group-item" \n            ng-repeat="labelType in labelTypes track by $index" \n            ng-init="labelPreviews[labelType] = getLabelPreview(labelType)" \n            ng-class="{active: current === labelType}" \n            ng-click="selectLabelType(labelType)" \n            style="cursor: pointer;">\n            <div class="list-group-item-heading">\n            <span class="glyphicon" ng-class="{\'glyphicon-check\': current === labelType, \'glyphicon-unchecked\': current !== labelType}"></span>\n               {{ i18n(labelType) }}\n               </div>\n              <div class="label-preview" ng-bind-html="labelPreviews[labelType]"></div>\n            </div>\n        </div>\n      ',scopeProperties:{labelTypes:this.labelTypes,current:this.type,fakeItems:this.fakeItems,selectLabelType:t=>{this.type=t,e(t),this.modal.modalInstance.close()},lg:this.lg,i18n:i,getLabelPreview:e=>this.lg.generateLabel(this.fakeItems[Math.floor(Math.random()*this.fakeItems.length)],e).outerHTML,closeModal:()=>{t(new Error("Modal closed without selection")),this.modal.modalInstance.close()}}})}))}}class f{modalService;notification;weight;controller;constructor(e,t,i,a){this.modalService=e,this.notification=t,this.weight=i,this.controller=a}show(){return this.modalService.showModal({template:`\n        <div class="modal-body">\n          <div ng-controller="ReferenceBookItems as c" class="row">\n            <div class="col-xs-12">\n              <div class="margin-bottom-5 row sticky row-no-gutters">\n                <button ng-show="!c.grid.config.isLoading" \n                        ng-disabled="selected(c.grid) == 0" \n                        type="button" \n                        class="btn btn-sm btn-purple" \n                        ng-click="print(c.grid.provider.getSelected())">\n                  <i class="fa fa-fw fa-print"></i> ${i("print")}\n                </button>\n                <button ng-show="!c.grid.config.isLoading && weight"\n                        ng-disabled="!isWeighted(c.grid)" \n                        type="button" \n                        class="btn btn-sm btn-pink" \n                        ng-click="weightLabel(c.grid.provider.getSelected())">\n                  <i class="fa fa-fw fa-balance-scale"></i> ${i("weightLabel")}\n                </button>\n                <button ng-show="!c.grid.config.isLoading && controller != undefined"\n                        ng-disabled="selected(c.grid) == 0" \n                        type="button" \n                        class="btn btn-sm btn-primary" \n                        ng-click="proccessItem(c.grid.provider.getSelected())">\n                  <i class="fa fa-fw fa-plus"></i> ${i("add")}\n                </button>\n                <button ng-show="!c.grid.config.isLoading && controller != undefined"\n                        type="button" \n                        class="btn btn-sm btn-white" \n                        ng-click="openTypeModal()">\n                   <i class="fa fa-caret-down"></i>  ${i("type")}\n                </button>\n                <button class="btn btn-sm pull-right" ng-click="closeModal()">\n                  <i class="fa fa-fw fa-times"></i> ${i("close")}\n                </button>\n              </div>\n              <extd-grid\n                config="c.grid.config"\n                filter="c.grid.filter"\n                data="c.grid.data">\n              </extd-grid>\n            </div>\n          </div>\n        </div>`,scopeProperties:{weight:this.weight,controller:this.controller,weightLabel:e=>{e&&1===e.length&&e[0].measurementUnitCanBeWeighed?this.weight?.show(e[0]):this.notification.error(i("weightedItem")+"?")},print:async e=>{if(e.length<1)return void this.notification.error(i("noItemsSelected"));let t=await(this.controller?.getType());void 0===t&&await(new b).open().then((e=>{t=e})),new g(e,t)},selected:e=>e.provider.getSelected().length,isWeighted:e=>{const t=e.provider.getSelected();return 1===t.length&&t[0].measurementUnitCanBeWeighed},proccessItem:e=>{!e||e.length<1?this.notification.error(i("noItemsSelected")):void 0!==this.controller?e.forEach((e=>{this.controller?.processItem(e,!0)})):this.notification.error(i("error"))},openTypeModal:()=>{this.controller?.openTypeModal()}},size:"ext"})}}class y{modalService;constructor(e){this.modalService=e}async show(){await this.modalService.showModal({template:`\n        <div class="modal-body">\n          <temp-file-list type-id="{{typeId}}" open-for-select="openForSelect"></temp-file-list>\n        </div>\n        <div class="modal-footer">\n          <button class="btn" ng-click="closeModal()">\n            <i class="fa fa-times"></i>${i("close")}\n          </button>\n        </div>`,scopeProperties:{typeId:null,openForSelect:!1}})}}class M{request;modalService;tableData=[];saleItems=[];constructor(e){this.request=e,this.modalService=new h}async show(){0===this.tableData.length&&await this.loadData(),this.modalService.showModal({template:`\n        <div class="modal-header">\n          <h4 class="modal-title pull-left">${i("markdowns")}</h4>\n          <div class="pull-right">\n            <button ng-click="goToURL()" class="btn btn-sm btn-purple" type="button">\n              <i class="fa fa-external-link"></i> ${i("weeklyReports")}\n            </button>\n            <button ng-click="closeModal()" class="btn btn-sm btn-white" type="button">\n              <i class="fa fa-times"></i> ${i("close")}\n            </button>\n          </div>\n        </div>\n        <div class="modal-body">\n          <div ng-if="tableData.length === 0" class="alert alert-info">{{ noDataMessage }}</div>\n          <table class="table table-striped table-hover">\n            <thead>\n              <tr>\n                <th>${i("number")}</th>\n                <th>${i("date")}</th>\n                <th>${i("discount")}</th>\n                <th></th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr ng-repeat="row in tableData">\n                <td>{{row.series}} {{row.number}}</td>\n                <td>{{row.saleDate}}</td>\n                <td>{{row.discount}}</td>\n                <td>\n                  <button class="btn btn-xs btn-block btn-primary" ng-click="showSaleItems(row.id, row.saleDate)">\n                    ${i("show")}\n                  </button>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      `,scopeProperties:{tableData:this.tableData,noDataMessage:this.tableData.length?"":i("loading"),closeModal:()=>this.modalService.modalInstance.close(),goToURL:this.goToURL.bind(this),showSaleItems:this.showSaleItems.bind(this)}})}async loadData(){const e=await this.request.getSales("nur");this.tableData=e?e.data.map((e=>({id:e.id,series:e.series,number:e.number,saleDate:e.saleDate,discount:e.discount}))):[]}async showSaleItems(e,t){const a=await this.request.getSaleItems(e);this.saleItems=a?.data.map((e=>({itemId:e.itemId,virtualName:e.virtualName,quantity:e.quantity,total:e.sumWithoutVat+e.vat,discount:e.discount,discountRate:e.discountRate,virtualUnit:e.virtualUnit}))).filter((e=>e.discount<0))||[],this.modalService.showModal({template:`\n        <div class="modal-header">\n          <button type="button" class="close" ng-click="closeModal()">\n            <span>&times;</span>\n          </button>\n          <h4 class="modal-title">${i("markdowns")} <span class="text-primary">${t}</span></h4>\n        </div>\n        <div class="modal-body">\n          <table class="table table-striped table-hover">\n            <thead>\n              <tr>\n                <th>ID</th>\n                <th>${i("name")}</th>\n                <th>${i("quantity")}</th>\n                <th>${i("total")}</th>\n                <th>${i("discount")}</th>\n                <th>${i("discountRate")}</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr ng-repeat="item in saleItems">\n                <td>{{item.itemId}}</td>\n                <td>{{item.virtualName}}</td>\n                <td>{{item.quantity}} {{item.virtualUnit.measurementUnitName}}</td>\n                <td>{{item.total.toFixed(2)}}</td>\n                <td>{{item.discount}}</td>\n                <td>{{item.discountRate}}%</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" ng-click="closeModal()">${i("close")}</button>\n        </div>\n      `,scopeProperties:{saleItems:this.saleItems,closeModal:()=>this.modalService.modalInstance.close()}})}async goToURL(){const e=await GM.getValue("url","");""!==e&&window.open(e,"_blank")}}class I{$scope;notification=new n;req=new m(this.notification);modalService=new h;textToVoice=new u(this.notification);modals;constructor(e){this.$scope=e;const t=new p(this.modalService,this.notification,this);this.modals={weightLabel:t,details:new c(this.modalService,this.notification,this.req,t)},this.initializeScope().then((()=>{this.$scope.$digest()}))}async initializeScope(){Object.assign(this.$scope,{items:{grid:[],recent:await this.req.getRecentlyModifiedItems(),searched:this.getRecentlySearchedItems()},settings:{sayOutLoud:!0,showStock:!1,type:"normal"},tabs:!0,companyName:s.getCurrentCompany(),loading:!1,barcode:null,printed:!1,draft:!1,modals:this.modals,activeTab:"recentlyModified",openMarkdowns:this.openMarkdowns.bind(this),openCatalog:this.openCatalog.bind(this),openFiles:this.openFiles.bind(this),openTypeModal:this.openTypeModal.bind(this),searchBarcode:this.searchBarcode.bind(this),print:this.print.bind(this),cleanAll:this.cleanAll.bind(this),handleEnterPress:this.handleEnterPress.bind(this),removeItem:this.removeItem.bind(this),showDetails:this.showDetails.bind(this),quickPriceChange:e=>{this.req.quickPriceChange(e)},getPricePerUnit:g.getPricePerUnit,getFriendlyTime:r.bind(this),isItRecent:l.bind(this),showWeightModal:this.showWeightModal.bind(this),clearBarcodeInput:this.clearBarcodeInput.bind(this),refreshCurrentTab:this.refreshCurrentTab.bind(this),changeActiveTab:this.changeActiveTab.bind(this),toggleTabs:this.toggleTabs.bind(this),getTotalPrice:this.getTotalPrice.bind(this),saveDraft:this.saveDraft.bind(this),printDraft:this.printDraft.bind(this),changeQuantity:this.changeQuantity.bind(this)})}openMarkdowns(){new M(this.req).show()}openCatalog(){new f(this.modalService,this.notification,this.modals.weightLabel,this).show().then((()=>{this.$scope.$digest()}))}openFiles(){new y(this.modalService).show()}openTypeModal(){new b(this.$scope.settings.type).open().then((e=>{this.setType(e)})).catch((()=>{this.notification.error(i("modalClosed"))}))}getType(){const e=this.$scope.settings.type;return void 0===e?(new b).open():e}setType(e){this.$scope.settings.type=e,this.$scope.$digest()}async searchBarcode(){if(this.$scope.printed=!1,!this.$scope.barcode)return void this.notification.error(i("missingBarcode"));const e=this.$scope.barcode.toString().trim();this.clearBarcodeInput(),this.canItBePackaged(e)?await this.searchforAPackagedItem(e):await this.searchItem(e)}canItBePackaged(e){const t=parseInt(e.slice(0,2),10);return(13===e.length||21===e.length)&&t>20&&t<30}async searchItem(e){this.$scope.loading=!0;const t=await this.req.getItem(e);t?await this.processItem(t):this.notFound(e),this.$scope.loading=!1,this.$scope.$digest()}async searchforAPackagedItem(e){const t=this.extractBarcodePart(e);this.$scope.loading=!0;const i=await this.req.getItem(t);this.$scope.loading=!1,i?await this.processPackagedItem(i,e):this.notFound(e),this.$scope.$digest()}extractBarcodePart(e){return 13===e.length&&["23","24"].includes(e.slice(0,2))?e.slice(0,8):13===e.length&&["25","29"].includes(e.slice(0,2))?e.slice(0,7):21===e.length?e.slice(4,17):e}async processPackagedItem(e,t){e.weight=this.calculateWeight(t),e.totalPrice=o(e.priceWithVat,e.weight),await this.processItem(e)}calculateWeight(e){const t=e.length>13?e.slice(17,21):e.slice(8,12);return parseInt(t,10)/1e3}async processItem(e,t=!1){this.handleNotifications(e,t),this.$scope.items.grid.push(e),this.scrollToLastItem(),e.weight||this.saveSearchedItemLocally(e)}handleNotifications(e,t){if(t)this.notification.success({title:i("itemAdded"),message:e.name,delay:2e3});else{if(!this.$scope.settings.sayOutLoud)return;!e.isActive&&e.priceWithVat>0?this.textToVoice.speak(i("itemNotActive")):this.$scope.settings.showStock&&null!=e.stock?this.textToVoice.speak(e.stock.toString()):this.isDuplicateItem(e)?this.textToVoice.speak(this.getDuplicateItemMessage(e)):e.priceWithVat>0?this.textToVoice.speak(i("price")+" "+this.textToVoice.digitsToPrice(e.totalPrice??e.priceWithVat)):this.textToVoice.speak(i("priceNotSet"))}}isDuplicateItem(e){const t=this.$scope.items.grid[this.$scope.items.grid.length-1];return t&&t.barcode===e.barcode&&"weight"in t&&"weight"in e&&t.weight===e.weight}getDuplicateItemMessage(e){return i("asMentioned")+", "+i("price")+" "+this.textToVoice.digitsToPrice(e.totalPrice??e.priceWithVat)+(void 0!==e.weight?". "+i("weight")+this.textToVoice.numberToWords(parseFloat(e.weight.toString()))+e.measurementUnitName:"")+" "+i("thisIs")+" "+e.name}scrollToLastItem(){setTimeout((()=>{const e=document.querySelectorAll(".item-list .item"),t=e[e.length-1];t?.scrollIntoView({behavior:"smooth",block:"end"})}),0)}notFound(e){const t={name:`${i("itemNotFound")} (${i("barcode")}: ${e})`,barcode:e,isActive:!1};this.$scope.items.grid.push(t),this.notification.error(`Item not found: ${e}`)}print(e=this.$scope.items.grid.filter((e=>e))){if(0===e.length)return void this.notification.error(i("noData"));new g(e,this.$scope.settings.type).success&&(this.cleanAll(),this.$scope.printed=!0)}cleanAll(){this.$scope.items.grid=[]}async handleEnterPress(e){"Enter"===e.key&&await this.searchBarcode()}removeItem(e){this.$scope.items.grid.splice(e,1)}showDetails(e){this.modals.details.show(e)}showWeightModal(e){this.modals.weightLabel.show(e).then((()=>{this.$scope.$digest()}))}clearBarcodeInput(){this.$scope.barcode=null}getAgoText(e){const t=new Date;if(e){const a=Math.abs(t.getTime()-new Date(e).getTime()),n=Math.floor(a/1e3);return n<15?null:i("ago")+" "+n+" "+i("seconds")}return null}saveSearchedItemLocally(e){const t=this.getRecentlySearchedItems(),i=t.findIndex((t=>t.barcode===e.barcode));-1!==i&&t.splice(i,1),e.printedAt=(new Date).toISOString(),t.unshift(e),t.length>50&&t.pop(),localStorage.setItem("items",JSON.stringify(t)),this.$scope.items.searched=t}getRecentlySearchedItems(){return JSON.parse(localStorage.getItem("items")??"[]")}getRecentlySearchedItemIds(){return this.getRecentlySearchedItems().map((e=>e.id))}async updateSearchedItems(){const e=this.getRecentlySearchedItemIds(),t=await this.req.getItemsByIds(e);localStorage.setItem("items",JSON.stringify(t)),this.$scope.items.searched=t,this.$scope.$digest()}async updateRecentItems(e=!1){const t=await this.req.getRecentlyModifiedItems(e);this.$scope.items.recent=t,this.$scope.$digest()}async refreshCurrentTab(){"recentlyModified"===this.$scope.activeTab?this.updateRecentItems(!0):this.updateSearchedItems()}changeActiveTab(e){this.$scope.activeTab=e}toggleTabs(){this.$scope.tabs=!this.$scope.tabs}changeQuantity(e){const t=this.$scope.items.grid[e];if(!t||!t.priceWithVat)return void this.notification.error(i("noData"));const a=prompt(i("changeQuantity"),t.weight?.toString()||"1");if(null!==a){const n=parseFloat(a);if(isNaN(n)||n<=0)return void this.notification.error(i("invalidQuantity"));t.weight=n,t.totalPrice=o(t.priceWithVat,n),this.$scope.items.grid[e]=t,this.notification.success({title:i("quantityChanged"),message:`${t.name} - ${n} ${t.measurementUnitName}`})}}getTotalPrice(){return this.$scope.items.grid.reduce(((e,t)=>e+(t.totalPrice??t.priceWithVat)+(t.packageCode?.1*t.packageQuantity:0)),0)}saveDraft(){const e=this.$scope.items.grid.map((e=>({...e,printedAt:(new Date).toISOString()}))),t=JSON.parse(localStorage.getItem("drafts")??"[]");t.push(...e),t.length>50&&t.splice(0,t.length-50),localStorage.setItem("drafts",JSON.stringify(t)),this.$scope.draft=!0,this.$scope.items.grid=[],this.notification.success(i("draftSaved"))}printDraft(){0!==this.$scope.items.grid.length||this.notification.error(i("noItemsToPrint"))}}class A{active=!1;isActive(){return this.active=null!==document.querySelector(".item-search-container"),this.active}init(){if(this.isActive())return!0;const e=document.querySelector(".main-container"),t=document.querySelector(".navbar-dark"),i=document.querySelector(".footer");return null!=t&&null!=i&&null!=e&&(this.removeElements(t),this.injectHtml(e),this.removeElements(i,e),this.changeDocumentTitle(),document.body.classList.add("label-print-interface"),this.bindEvents(),!0)}removeElements(...e){e.forEach((e=>{e.remove()}))}injectHtml(e){angular.module("b1",[]).controller("DynamicController",["$scope",I]),angular.module("b1").filter("i18n",(()=>e=>i(e)));const t=document.createElement("div");t.setAttribute("ng-controller","DynamicController"),t.innerHTML='<nav class="navbar"> <a class="navbar-brand header-flex" target="_self" href="/"> <span class="smaller-60 white">{{ companyName }}</span> </a> <div class="navbar-shortcuts"> <ul> <li> <a class="navbar-shortcut" href="#" ng-click="draft = !draft"> <i class="fa fa-fw fa-pencil"></i> <span class="hidden-xs"> {{ \'draft\' | i18n }}</span> </a> </li> <li> <a class="navbar-shortcut" href="#" ng-click="openMarkdowns()"> <i class="fa fa-fw fa-book"></i> <span class="hidden-xs"> {{ \'markdowns\' | i18n }}</span> </a> </li> <li> <a class="navbar-shortcut" href="#" ng-click="openCatalog()"> <i class="fa fa-fw fa-folder-open"></i> <span class="hidden-xs"> {{ \'itemCatalog\' | i18n }}</span> </a> </li> <li> <a class="navbar-shortcut" href="#" ng-click="openFiles()"> <i class="fa fa-fw fa-files-o"></i> <span class="hidden-xs"> {{ \'files\' | i18n }}</span> </a> </li> <li> <a class="navbar-shortcut" href="/logout" target="_self"> <i class="fa fa-fw fa-power-off"></i> </a> </li> </ul> </div>\n</nav> <div class="container item-search-container"> <div class="row"> <div class="col-md-4 no-padding"> <div class="form-section"> <h4 class="header">{{ \'labels\' | i18n }}</h4> <div class="form-group input-group"> <input type="text" class="form-control" ng-model="barcode" placeholder="{{ \'enterBarcode\' | i18n }}" autocomplete="off" ng-keyup="handleEnterPress($event)" id="barcodeInput"> <button type="button" class="btn btn-info" ng-click="searchBarcode()">{{ \'code\' | i18n }}</button> </div> <div class="form-group"> <div class="checkbox-form"> <label> <input type="checkbox" class="ace" ng-model="settings.sayOutLoud"> <span class="lbl display-inline">&nbsp;{{ \'sayOutLoud\' | i18n }}</span> </label> </div> <div class="checkbox-form"> <label> <input type="checkbox" class="ace" ng-model="settings.showStock"> <span class="lbl display-inline">&nbsp;{{ \'showStock\' | i18n }}</span> </label> </div> </div> <div class="clearfix margin-bottom-10"> <div class="pull-right"> <button class="btn btn-white" ng-click="openTypeModal()"> {{ settings.type | i18n }} <i class="fa fa-caret-down"></i> </button> <button class="btn btn-purple" ng-click="print()"> <i class="fa fa-print"></i>&nbsp;{{ \'print\' | i18n }} </button> <button class="btn btn-danger" ng-click="cleanAll()"> {{ \'cleanAll\' | i18n }} </button> </div> </div> </div> <div class="summary" ng-if="draft"> <span class="summary-label"> {{ \'total\' | i18n }}</span> <span class="summary-amount">{{ getTotalPrice() }}</span> \x3c!-- buttons to save or print the draft --\x3e <div class="summary-buttons"> <button class="btn btn-success" ng-click="saveDraft()"> <i class="fa fa-save"></i> {{ \'saveDraft\' | i18n }} </button> <button class="btn btn-primary" ng-click="printDraft()"> <i class="fa fa-print"></i> {{ \'printDraft\' | i18n }} </button> </div> </div> </div> <div class="col-md-8 load-data"> <div ng-if="loading" class="load-overlay"> <div> <i class="fa fa-5x fa-b1-loader blue"></i> </div> </div> <div class="item-list"> <div ng-repeat="(index, item) in items.grid track by $index" class="item" ng-class="{\'inactive\': !item.barcode || !item.isActive, \'mark\': item.weight != null}"> <div class="item-main" ng-click="showDetails(item)"> <span class="item-price" ng-if="item.priceWithVat > 0">{{ (item.totalPrice || item.priceWithVat).toFixed(2) }}</span> <span class="item-stock text-primary" ng-if="settings.showStock && item.stock"> <i class="fa fa-home margin-right-5"></i>{{ item.stock }} </span> <span class="item-name">{{ item.name }}</span> </div> <div class="item-labels"> <span ng-repeat="label in [\'packageCode\', \'weight\', \'departmentNumber\', \'packageQuantity\']" ng-if="item[label] != null"> {{ label | i18n }}: {{ item[label] }} </span> <span ng-if="item.weight != null && item.priceWithVat != null"> {{ \'kiloPrice\' | i18n }}: <b>{{ item.priceWithVat.toFixed(2) }}</b> </span> <span ng-if="item.measurementUnitCanBeWeighed"> {{ \'weightedItem\' | i18n }} </span> <span ng-if="!item.measurementUnitCanBeWeighed && getPricePerUnit(item) != null && item.priceWithVat != null" class="pull-right text-light-grey"> {{ getPricePerUnit(item) }} </span> <span class="pull-right" ng-class="{\' text-bold text-danger\': isItRecent(item.modifiedAt), \'light-grey\': !isItRecent(item.modifiedAt)}" ng-if=" getFriendlyTime(item.modifiedAt) != null"> <i class="fa fa-edit"></i> {{ getFriendlyTime(item.modifiedAt) }}</span> </div> <button class="btn btn-yellow" ng-click="removeItem($index)"> <i class="fa fa-trash"></i> </button> <button class="btn btn-pink" ng-if="item.measurementUnitCanBeWeighed && item.priceWithVat > 0" ng-click="showWeightModal(item)"> <i class="fa fa-balance-scale"></i> </button> <button class="btn btn-danger" ng-if="item.id && !item.priceWithVat" ng-click="quickPriceChange($index)"> <i class="fa fa-euro"></i> </button> <button class="btn btn-secondary" ng-if="item.id && item.priceWithVat && draft" ng-click="changeQuantity($index)"> <span class="quantity-label">{{ item.weight || 1 }}</span> <i class="fa fa-pencil"></i> </button> </div> </div> <div ng-if="items.grid.length === 0"> <div class="alert text-center" ng-class="{\'alert-info\': !printed, \'alert-success\': printed}"> <svg width="65" height="40" viewBox="10 30 70 40" fill="none" xmlns="http://www.w3.org/2000/svg" ng-if="!printed"> <rect x="10" y="30" width="5" height="40" fill="#333"></rect> <rect x="20" y="30" width="3" height="40" fill="#333"></rect> <rect x="28" y="30" width="6" height="40" fill="#333"></rect> <rect x="40" y="30" width="3" height="40" fill="#333"></rect> <rect x="50" y="30" width="8" height="40" fill="#333"></rect> <rect x="65" y="30" width="4" height="40" fill="#333"></rect> <rect x="75" y="30" width="5" height="40" fill="#333"></rect> <rect x="10" y="50" width="70" height="3" fill="red"> <animateTransform attributeName="transform" type="translate" values="0 0; 0 7; 0 -3; 0 4; 0 0" keyTimes="0;0.2;0.5;0.8;1" dur="2.4s" calcMode="spline" keySplines="0.25 0.1 0.25 1; 0.45 0 0.55 1; 0.25 0.1 0.25 1; 0.3 0 0.7 1" repeatCount="indefinite" /> <animateTransform attributeName="transform" type="rotate" additive="sum" values="0;2;-1;2;0" keyTimes="0;0.3;0.6;0.8;1" dur="1.7s" calcMode="spline" keySplines="0.5 0 0.5 1; 0.5 0 0.5 1; 0.5 0 0.5 1; 0.5 0 0.5 1" repeatCount="indefinite" /> </rect> </svg> <svg width="60" height="70" viewBox="0 0 60 70" fill="none" xmlns="http://www.w3.org/2000/svg" ng-if="printed"> <rect x="5" y="40" width="50" height="10" fill="#555" rx="2"></rect> <g> <rect fill="#d5d5d5" x="10" y="20" width="40" height="20"></rect> <line x1="15" y1="35" x2="45" y2="35" stroke="#888" stroke-width="2"></line> <line x1="15" y1="30" x2="45" y2="30" stroke="#888" stroke-width="2"></line> <animateTransform attributeName="transform" type="translate" values="0,0; 0,22; 0,22" keyTimes="0; 0.33; 1" dur="2s" repeatCount="indefinite"></animateTransform> </g> <rect x="0" y="0" width="60" height="40" fill="#333" rx="5"></rect> <circle cx="55" cy="10" r="3" fill="#2196f3"></circle> </svg> <div> <span ng-if="printed">{{ \'printJobIsSent\' | i18n }}.</span> <span>{{ \'noItemsScanned\' | i18n }}.</span> </div> </div> <div class="recent-items" ng-if="tabs"> <ul class="nav nav-tabs"> <li class="nav-item" ng-class="{\'active\': activeTab === \'recentlyModified\'}" ng-click="changeActiveTab(\'recentlyModified\')"> <a>{{ \'recentlyModified\' | i18n }}</a> </li> <li class="nav-item" ng-class="{\'active\': activeTab === \'recentlySearched\'}" ng-click="changeActiveTab(\'recentlySearched\')" ng-if="items.searched.length > 0"> <a>{{ \'recentlySearched\' | i18n }}</a> </li> <div class="pull-right header-flex" style="height: 3rem;"> <button class="btn btn-white btn-xs" ng-click="refreshCurrentTab()"> {{ \'refresh\' | i18n }}<i class="fa fa-refresh padding-left-10"></i> </button> <button class="btn-link black" ng-click="toggleTabs()"> <i class="fa fa-times"></i> </button> </div> </ul> <div class="tab-content item-list recent-tab-content"> <div ng-repeat="item in (activeTab === \'recentlyModified\' ? items.recent : items.searched) | limitTo:20 track by $index" class="item" ng-class="{\'inactive\': !item.barcode || !item.isActive, \'green\': item.noNeedToPrint}"> <div class="item-main"> <span class="item-name"> {{ item.name }} </span> </div> <button class="btn btn-xs btn-pink" ng-if="item.measurementUnitCanBeWeighed && item.priceWithVat > 0" ng-click="showWeightModal(item)"> <i class="fa fa-balance-scale"></i> </button> <span class="item-price" ng-if="item.priceWithVat > 0">{{ item.priceWithVat.toFixed(2) }}</span> <button class="btn btn-xs btn-purple" ng-click="print([item])"> <i class="fa fa-print"></i> <i class="fa fa-bolt"></i> </button> </div> </div> </div> <div class="alert-xs grey text-center margin-10">{{ \'help\' | i18n }}</div> </div> </div> </div>\n</div>',e.insertAdjacentElement("beforebegin",t),angular.injector(["ng","b1"]).invoke(["$compile","$rootScope",function(e,i){const a=i.$new();e(t)(a),a.$digest()}])}bindEvents(){const e=document.getElementById("barcodeInput");null!=e&&(e.focus(),document.addEventListener("click",(t=>{let i=!1;document.querySelectorAll(".modal.in").forEach((e=>{e.contains(t.target)&&(i=!0)})),i||null==e||e.focus()})))}changeDocumentTitle(){document.title=i("labels")}}class w{user=new s;interface=new A;constructor(){this.init(),console.debug("LabelsUserscript initialized")}init(){this.addStyles(),this.user.isLoggedIn&&this.user.admin?this.addActivateButton():this.user.isLoggedIn&&!this.user.admin?this.interface.init():this.user.isLoggedIn||"/login"!==window.location.pathname||this.user.addLoginOptions()}addStyles(){const e=document.createElement("style");e.textContent='body.label-print-interface{background-color:#eee}body.label-print-interface tr.sub-grid-row,body.label-print-interface td.sub-grid,body.label-print-interface [ng-if="config.subGrid"],body.label-print-interface [ng-if="!config.hideTopPager"],body.label-print-interface .sidebar{display:none !important;pointer-events:none}body.label-print-interface .input-group{display:flex}body.label-print-interface .modal h5.header.blue.header-temp-files-list{margin-top:0}body.label-print-interface .modal .btn,body.label-print-interface .modal select,body.label-print-interface .modal input[type=text],body.label-print-interface .modal input[type=number],body.label-print-interface .modal input[type=date]{border-radius:4px !important}body.label-print-interface .navbar{background:#2e8b57}body.label-print-interface .navbar .navbar-brand{padding-left:1em}body.label-print-interface .navbar .navbar-shortcuts{margin-right:10px}body.label-print-interface .navbar a.navbar-shortcut{color:#eee}body.label-print-interface .navbar a.navbar-shortcut i{font-size:1.2em;margin:0 2px;text-align:center}body.label-print-interface .navbar li:has(.navbar-shortcut):hover{background:rgba(0,0,0,.3607843137)}body.label-print-interface .summary{background:#fff;border-top:#000 2px dashed;padding:10px;margin-top:10px}body.label-print-interface .summary .summary-amount{float:right;padding-right:51px;font-weight:700}body.label-print-interface .summary .summary-label{font-weight:700;color:#333}body.label-print-interface .summary .summary-buttons{display:flex;gap:10px;margin-top:10px}body.label-print-interface .summary .summary-buttons button{flex:1}.item-search-container *:not(.header):not(svg){border-radius:4px}.item-search-container .load-data{padding:10px}@media screen and (max-width: 992px){.item-search-container .load-data{padding:10px 0 !important}}.item-search-container .load-overlay{background-color:rgba(238,238,238,.7490196078)}.item-search-container .form-section{border:1px solid #ddd;margin-top:10px;background-color:#fcfcfc;padding:0 15px}.item-search-container .item-list{max-height:calc(100vh - 70px);overflow:auto}.item-search-container .item-list .item{transition:.5s;animation:highlight .5s ease-out;background-color:#fff;display:grid;grid-template-columns:minmax(0, 1fr) min-content min-content min-content;column-gap:5px;font-size:1.1em;border:1px solid #ddd;padding:8px;margin-bottom:4px;cursor:pointer;position:relative}.item-search-container .item-list .item .item-price,.item-search-container .item-list .item .item-stock{font-weight:bold;background-color:var(--theme-blue--dark-bg);color:#fff;padding:2px 8px;margin-right:4px;transition:.5s}.item-search-container .item-list .item.inactive span.item-price{filter:blur(1px);background-color:darkred;display:inline-block;animation:vibrate .3s linear infinite both}.item-search-container .item-list .item.inactive{color:darkred}.item-search-container .item-list .item .item-stock{background-color:#777}.item-search-container .item-list .item .item-main{grid-row:1;grid-column:1}.item-search-container .item-list .item .item-labels{grid-column:1;grid-row:2;align-self:center}.item-search-container .item-list .item .btn{grid-row:1/span 2;border:none}.item-search-container .item-list .item .btn-yellow{grid-column:3}.item-search-container .item-list .item:not(.inactive):last-child{margin-bottom:30px;animation:highlight .5s ease-out,emphasizeItem .5s ease-in-out 5s backwards}.item-search-container .item-list .item.inactive{background-color:#f8d7da}.item-search-container .item-list .item.mark{background-color:#fcf8e3}.item-search-container .item-list .item.green{background-color:#e4efc9}.item-search-container .item-list .item:hover{background-color:#f1f1f1}.item-search-container .item-list .item *:empty:not(i){display:none}.item-search-container .item-list .item:not(.inactive):last-child .item-price{animation:emphasizePrice .5s ease-in-out 5s backwards}.item-search-container .item-labels{font-size:.8em;color:#666}.item-search-container .item-labels span{margin-right:10px}.item-search-container .form-group{position:relative}.item-search-container .ready-for-scan{opacity:0;transition:.5s;position:absolute;right:0%;width:80px;text-align:right;color:var(--theme-orange--base-bg);padding-top:35px;text-transform:lowercase}.item-search-container #barcode:focus:placeholder-shown+.ready-for-scan{opacity:1}.item-search-container .recent-items .recent-tab-content{background:#fff;padding:10px;border-radius:0}.item-search-container .recent-items .item-list .item{padding:8px;column-gap:0px}.item-search-container .recent-items .item-list .item .btn{grid-row:unset}.item-search-container .recent-items .item-list .item .item-price,.item-search-container .recent-items .item-list .item .btn-xs{padding:0px 6px;margin-left:5px}.item-search-container .recent-items .item-list .item-main{text-overflow:clip;overflow:hidden;white-space:nowrap}.item-search-container .recent-items .item-list .item-price{margin-right:0px}.item-search-container .recent-items .item-list .item,.item-search-container .recent-items .item-list .item:last-child{animation:none;margin-bottom:4px;padding:6px}.item-search-container .recent-items .item-list .item:last-child .item-price{animation:none}.container.width-auto>.row{padding:5px 0px;border-bottom:1px solid #eee}.keyboard{display:grid;background-color:#f5f5f5;padding:10px;grid-template-columns:repeat(3, 1fr);gap:10px;width:200px;margin:0px auto;border-radius:2px}.keyboard>*{padding:10px;font-size:18px}.modal .list-group{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:15px}.modal .list-group .label p:empty:nth-of-type(1)::before{content:" ";display:block;background-image:repeating-linear-gradient(to right, black, black 4px, white 5px, white 10px);position:static;height:15px;width:120px}.modal .list-group .label.barcodeOnly p:empty:nth-of-type(1)::before{height:50px}.modal .list-group .label .barcode.dm{background-image:repeating-linear-gradient(to top, black, black 4px, white 4px, white 8px)}.modal .list-group .label.fridge::after{content:"";height:20px;width:100%;background-image:url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKIHdpZHRoPSI3NjguMDAwMDAwcHQiIGhlaWdodD0iMTI4MC4wMDAwMDBwdCIgdmlld0JveD0iMCAwIDc2OC4wMDAwMDAgMTI4MC4wMDAwMDAiCiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCBtZWV0Ij4KPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsMTI4MC4wMDAwMDApIHNjYWxlKDAuMTAwMDAwLC0wLjEwMDAwMCkiCmZpbGw9IiMwMDAwMDAiIHN0cm9rZT0ibm9uZSI+CjxwYXRoIGQ9Ik01NzgyIDEyNTIzIGMtMTYgLTQzIC00NTYgLTEyMTYgLTk3NyAtMjYwOCAtNTIxIC0xMzkxIC05NTAgLTI1MzMKLTk1NCAtMjUzNyAtMyAtNCAtMTI3IDMwMiAtMjc1IDY4MCAtMTQ4IDM3OCAtMzAyIDc3MCAtMzQyIDg3MiAtMzkgMTAyIC0xODcKNDc4IC0zMjcgODM1IC0xNDAgMzU4IC0yNzYgNzA0IC0zMDIgNzcwIC00NyAxMjAgLTI3NSA3MDEgLTYwMSAxNTMzIC05NiAyNDQKLTE3NCA0NDcgLTE3NCA0NTIgMCAzMCAtMzAgMTQgLTkyIC00NiAtMjMwIC0yMjYgLTM2NiAtNDkzIC00MzUgLTg1OCAtMjYKLTEzNCAtMjUgLTU4NSAwIC03NDQgNDAgLTI0NyA4NyAtNDA5IDIyNyAtNzc3IDU0IC0xNDMgMTQzIC0zODAgMTk4IC01MjUgNTUKLTE0NiAxMzMgLTM1MCAxNzIgLTQ1NSA0MCAtMTA0IDExMCAtMjkxIDE1NyAtNDE1IDQ3IC0xMjQgMTA5IC0yODggMTM4IC0zNjUKMjkgLTc3IDE0OCAtMzkyIDI2NSAtNzAwIDExNiAtMzA4IDI5NCAtNzc4IDM5NSAtMTA0NSAxMDEgLTI2NyAyMjYgLTU5OCAyNzgKLTczNyBsOTUgLTI1MSAtNDAgLTc3IGMtMTU3IC0yOTkgLTMwMSAtNjkwIC0zOTggLTEwNzQgLTY0IC0yNTQgLTk1IC00MTYKLTE4MCAtOTI2IC03NiAtNDUyIC0xMjQgLTU4MiAtMjI3IC02MTYgLTY4IC0yMiAtMTUzIDMgLTI5NyA4OCAtMTYyIDk1IC0yODIKMTIyIC01NTIgMTIzIC0xOTggMCAtMzAxIC0xMyAtNDIxIC01NCAtNDI4IC0xNDYgLTc2NiAtNTUyIC04NzUgLTEwNDkgLTIwCi04OSAtMjIgLTEzMSAtMjIgLTMyMiAwIC0xODggNCAtMjM1IDIyIC0zMjMgMzMgLTE1MSA2NyAtMjU0IDEyOCAtMzc3IDE4NAotMzc5IDQ4NSAtNjQwIDg0OSAtNzM2IDE1OCAtNDIgNDIxIC00OCA1OTIgLTE0IDI3OSA1NiA1MTUgMTg2IDcyOSAzOTkgMTMyCjEzMyAyMTYgMjQ5IDI4OSA0MDAgODQgMTc1IDExNSAzMDEgMTQxIDU2NiAxNyAxODUgMTYgMzYzIC03IDkyNSAtMzIgNzk0IDc0CjEyOTEgMzU2IDE2NjYgOTIgMTI0IDI2MiAyODMgMzk3IDM3MyA2MyA0MiAxMjAgNzYgMTI3IDc2IDYgMCA1MyAtMjUgMTAzIC01NgoyMzQgLTE0MiA0MTQgLTMxNCA1NTUgLTUzMiAxMzggLTIxMSAyMzMgLTQ4OCAyNzggLTgxMiAyMyAtMTYwIDMwIC01OTcgMTYKLTg4MyAtMTcgLTMyNyAzIC01OTQgNjQgLTg1MiAxNTggLTY2OSA1NTggLTEwOTggMTEzMSAtMTIxMSAxMzIgLTI3IDM3NSAtMjQKNTE0IDUgNDcyIDk5IDgyMiAzODIgOTY0IDc3OSAxNDUgNDA4IDE1MiA3OTMgMTkgMTE3NiAtMjM3IDY4NSAtODg4IDEwNDcKLTE1MzggODU0IC0zOCAtMTEgLTE0OSAtNTIgLTI0NSAtOTEgLTE1NSAtNjIgLTE4NCAtNzAgLTI1NSAtNzQgLTcwIC0zIC04NQotMSAtMTIwIDE5IC03NyA0NSAtOTcgOTQgLTE1MSAzNzMgLTk3IDUwMyAtMTMwIDY1NiAtMTc1IDgzNCAtMTA3IDQyMiAtMjM2Cjc5NiAtNDI1IDEyMzggbC02NiAxNTIgNTAgMTQzIGM1MCAxNDEgNTY2IDE2MTkgODQ5IDI0MjggNzkgMjI4IDE4MCA1MTYgMjIzCjY0MCA0MyAxMjQgMjA2IDU5MiAzNjMgMTA0MCAzNTggMTAyNiAzNzIgMTA4MSAzNzIgMTQ4NSAwIDI3NSAtMTkgNDAxIC05Mgo2MTUgLTgwIDIzNCAtMjYwIDUwNyAtNDM0IDY1OSBsLTI3IDIzIC0zMCAtNzl6IG02MjggLTk4NDggYzExMSAtMjggMjU3IC05MgozMzUgLTE0NSAxMjQgLTg1IDIzNiAtMjE5IDI4OCAtMzQ1IDczIC0xNzggMTAxIC0zMzIgOTQgLTUyNCAtMTEgLTI5NyAtMTEzCi01NDEgLTMwMCAtNzE3IC0xNjUgLTE1NSAtMzM0IC0yMTIgLTU5NyAtMjAxIC0xNTAgNiAtMjU4IDM1IC0zOTEgMTAzIC0yODUKMTQ4IC00OTYgNDEyIC01ODEgNzI5IC0xOCA2NSAtMjIgMTA3IC0yMiAyMzAgMSAxMzQgMyAxNTkgMjggMjM5IDM2IDExOSAxMjUKMjk5IDE4MCAzNjYgMTE4IDE0MiAzMDIgMjQ1IDUwMSAyNzkgMzMgNiA3MSAxMyA4NSAxNSA2OSAxMyAyNzggLTQgMzgwIC0yOXoKbS00NTE4IC0zNCBjMTgyIC00NyAyODAgLTEwMyA0MDggLTIzMSA4MSAtODEgMTAzIC0xMDkgMTQzIC0xOTAgMTE3IC0yMzYgMTQyCi00NTUgODEgLTcxMCAtOTAgLTM3MSAtMzg2IC03MDAgLTcxOSAtNzk5IC0yNDIgLTcyIC01NDQgLTI1IC03NTEgMTE3IC02NyA0NQotMTc1IDE1NCAtMjIzIDIyNCAtMTIxIDE3OSAtMTkwIDQ0MCAtMTc4IDY3MyA4IDE0MyAzNyAyNTYgOTcgMzgxIDE0MCAyOTAKNDExIDQ5MiA3MzggNTUwIDEwNyAxOSAzMDQgMTEgNDA0IC0xNXoiLz4KPC9nPgo8L3N2Zz4=");background-size:81% 100%;background-position:90% 50%;background-repeat:no-repeat;bottom:.6mm;right:3em;opacity:.7;background-blend-mode:color-dodge;width:2em;height:4em;transform:rotate(90deg)}.modal .list-group .label{border:1px solid #ff9b79}.modal .list-group .label-preview:has(.half){position:relative;display:inline-flex}.modal .list-group .label-preview:has(.half)::after{content:"";height:100%;width:20px;background-image:url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKIHdpZHRoPSI3NjguMDAwMDAwcHQiIGhlaWdodD0iMTI4MC4wMDAwMDBwdCIgdmlld0JveD0iMCAwIDc2OC4wMDAwMDAgMTI4MC4wMDAwMDAiCiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCBtZWV0Ij4KPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsMTI4MC4wMDAwMDApIHNjYWxlKDAuMTAwMDAwLC0wLjEwMDAwMCkiCmZpbGw9IiMwMDAwMDAiIHN0cm9rZT0ibm9uZSI+CjxwYXRoIGQ9Ik01NzgyIDEyNTIzIGMtMTYgLTQzIC00NTYgLTEyMTYgLTk3NyAtMjYwOCAtNTIxIC0xMzkxIC05NTAgLTI1MzMKLTk1NCAtMjUzNyAtMyAtNCAtMTI3IDMwMiAtMjc1IDY4MCAtMTQ4IDM3OCAtMzAyIDc3MCAtMzQyIDg3MiAtMzkgMTAyIC0xODcKNDc4IC0zMjcgODM1IC0xNDAgMzU4IC0yNzYgNzA0IC0zMDIgNzcwIC00NyAxMjAgLTI3NSA3MDEgLTYwMSAxNTMzIC05NiAyNDQKLTE3NCA0NDcgLTE3NCA0NTIgMCAzMCAtMzAgMTQgLTkyIC00NiAtMjMwIC0yMjYgLTM2NiAtNDkzIC00MzUgLTg1OCAtMjYKLTEzNCAtMjUgLTU4NSAwIC03NDQgNDAgLTI0NyA4NyAtNDA5IDIyNyAtNzc3IDU0IC0xNDMgMTQzIC0zODAgMTk4IC01MjUgNTUKLTE0NiAxMzMgLTM1MCAxNzIgLTQ1NSA0MCAtMTA0IDExMCAtMjkxIDE1NyAtNDE1IDQ3IC0xMjQgMTA5IC0yODggMTM4IC0zNjUKMjkgLTc3IDE0OCAtMzkyIDI2NSAtNzAwIDExNiAtMzA4IDI5NCAtNzc4IDM5NSAtMTA0NSAxMDEgLTI2NyAyMjYgLTU5OCAyNzgKLTczNyBsOTUgLTI1MSAtNDAgLTc3IGMtMTU3IC0yOTkgLTMwMSAtNjkwIC0zOTggLTEwNzQgLTY0IC0yNTQgLTk1IC00MTYKLTE4MCAtOTI2IC03NiAtNDUyIC0xMjQgLTU4MiAtMjI3IC02MTYgLTY4IC0yMiAtMTUzIDMgLTI5NyA4OCAtMTYyIDk1IC0yODIKMTIyIC01NTIgMTIzIC0xOTggMCAtMzAxIC0xMyAtNDIxIC01NCAtNDI4IC0xNDYgLTc2NiAtNTUyIC04NzUgLTEwNDkgLTIwCi04OSAtMjIgLTEzMSAtMjIgLTMyMiAwIC0xODggNCAtMjM1IDIyIC0zMjMgMzMgLTE1MSA2NyAtMjU0IDEyOCAtMzc3IDE4NAotMzc5IDQ4NSAtNjQwIDg0OSAtNzM2IDE1OCAtNDIgNDIxIC00OCA1OTIgLTE0IDI3OSA1NiA1MTUgMTg2IDcyOSAzOTkgMTMyCjEzMyAyMTYgMjQ5IDI4OSA0MDAgODQgMTc1IDExNSAzMDEgMTQxIDU2NiAxNyAxODUgMTYgMzYzIC03IDkyNSAtMzIgNzk0IDc0CjEyOTEgMzU2IDE2NjYgOTIgMTI0IDI2MiAyODMgMzk3IDM3MyA2MyA0MiAxMjAgNzYgMTI3IDc2IDYgMCA1MyAtMjUgMTAzIC01NgoyMzQgLTE0MiA0MTQgLTMxNCA1NTUgLTUzMiAxMzggLTIxMSAyMzMgLTQ4OCAyNzggLTgxMiAyMyAtMTYwIDMwIC01OTcgMTYKLTg4MyAtMTcgLTMyNyAzIC01OTQgNjQgLTg1MiAxNTggLTY2OSA1NTggLTEwOTggMTEzMSAtMTIxMSAxMzIgLTI3IDM3NSAtMjQKNTE0IDUgNDcyIDk5IDgyMiAzODIgOTY0IDc3OSAxNDUgNDA4IDE1MiA3OTMgMTkgMTE3NiAtMjM3IDY4NSAtODg4IDEwNDcKLTE1MzggODU0IC0zOCAtMTEgLTE0OSAtNTIgLTI0NSAtOTEgLTE1NSAtNjIgLTE4NCAtNzAgLTI1NSAtNzQgLTcwIC0zIC04NQotMSAtMTIwIDE5IC03NyA0NSAtOTcgOTQgLTE1MSAzNzMgLTk3IDUwMyAtMTMwIDY1NiAtMTc1IDgzNCAtMTA3IDQyMiAtMjM2Cjc5NiAtNDI1IDEyMzggbC02NiAxNTIgNTAgMTQzIGM1MCAxNDEgNTY2IDE2MTkgODQ5IDI0MjggNzkgMjI4IDE4MCA1MTYgMjIzCjY0MCA0MyAxMjQgMjA2IDU5MiAzNjMgMTA0MCAzNTggMTAyNiAzNzIgMTA4MSAzNzIgMTQ4NSAwIDI3NSAtMTkgNDAxIC05Mgo2MTUgLTgwIDIzNCAtMjYwIDUwNyAtNDM0IDY1OSBsLTI3IDIzIC0zMCAtNzl6IG02MjggLTk4NDggYzExMSAtMjggMjU3IC05MgozMzUgLTE0NSAxMjQgLTg1IDIzNiAtMjE5IDI4OCAtMzQ1IDczIC0xNzggMTAxIC0zMzIgOTQgLTUyNCAtMTEgLTI5NyAtMTEzCi01NDEgLTMwMCAtNzE3IC0xNjUgLTE1NSAtMzM0IC0yMTIgLTU5NyAtMjAxIC0xNTAgNiAtMjU4IDM1IC0zOTEgMTAzIC0yODUKMTQ4IC00OTYgNDEyIC01ODEgNzI5IC0xOCA2NSAtMjIgMTA3IC0yMiAyMzAgMSAxMzQgMyAxNTkgMjggMjM5IDM2IDExOSAxMjUKMjk5IDE4MCAzNjYgMTE4IDE0MiAzMDIgMjQ1IDUwMSAyNzkgMzMgNiA3MSAxMyA4NSAxNSA2OSAxMyAyNzggLTQgMzgwIC0yOXoKbS00NTE4IC0zNCBjMTgyIC00NyAyODAgLTEwMyA0MDggLTIzMSA4MSAtODEgMTAzIC0xMDkgMTQzIC0xOTAgMTE3IC0yMzYgMTQyCi00NTUgODEgLTcxMCAtOTAgLTM3MSAtMzg2IC03MDAgLTcxOSAtNzk5IC0yNDIgLTcyIC01NDQgLTI1IC03NTEgMTE3IC02NyA0NQotMTc1IDE1NCAtMjIzIDIyNCAtMTIxIDE3OSAtMTkwIDQ0MCAtMTc4IDY3MyA4IDE0MyAzNyAyNTYgOTcgMzgxIDE0MCAyOTAKNDExIDQ5MiA3MzggNTUwIDEwNyAxOSAzMDQgMTEgNDA0IC0xNXoiLz4KPC9nPgo8L3N2Zz4=");background-size:100% 25%;background-repeat:no-repeat;background-position:50% 86%;position:absolute;left:calc(100% - 10px);margin-right:-10px;z-index:1;opacity:.7}@keyframes emphasizeItem{from{font-size:1.2em}}@keyframes emphasizePrice{from{margin-left:-10px;padding-left:10px;border-radius:0px 5px 5px 0px;background-color:#000}}@keyframes highlight{from{background-color:#1b6aaa;color:#fff;filter:opacity(0.5)}}@keyframes vibrate{0%{transform:translate(0)}20%{transform:translate(-2px, 2px)}40%{transform:translate(-2px, -2px)}60%{transform:translate(2px, 2px)}80%{transform:translate(2px, -2px)}100%{transform:translate(0)}}',document.head.appendChild(e)}addActivateButton(){const e=document.querySelector(".breadcrumbs");if(null!=e){const t=document.createElement("button");t.textContent=i("labels"),t.className="btn btn-sm",t.addEventListener("click",(()=>{this.interface.init()})),e.appendChild(t)}return null!=e}}window.addEventListener("load",(()=>{new w}))}();
