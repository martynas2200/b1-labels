// ==UserScript==
// @name              B1 Accounting Tools
// @namespace         http://tampermonkey.net/
// @homepage          https://github.com/martynas2200/b1-labels
// @version           2.1.3
// @description       Additional accounting and inventory management tools
// @author            Martynas Miliauskas
// @match             https://www.b1.lt/*
// @icon              https://b1.lt/favicon.ico
// @connect           b1.lt
// @connect           raw.githubusercontent.com
// @downloadURL       https://raw.githubusercontent.com/martynas2200/b1-labels/main/dist/accounting.user.js
// @updateURL         https://raw.githubusercontent.com/martynas2200/b1-labels/main/dist/accounting.user.js
// @grant             GM.setValue
// @grant             GM.getValue
// @grant             unsafeWindow
// @grant             GM_xmlhttpRequest
// @license           GNU GPLv3
// @require           https://cdn.jsdelivr.net/npm/chart.js
// ==/UserScript==

!function(){"use strict";class e{$uibModal;$rootScope;modalInstance=null;constructor(){const e=angular.element(document.body).injector();this.$uibModal=e.get("$uibModal"),this.$rootScope=e.get("$rootScope")}async showModal(e){const t=this.$rootScope.$new(!0);return e.scopeProperties&&Object.defineProperties(t,Object.entries(e.scopeProperties).reduce(((t,[i,a])=>({...t,[i]:{get:()=>e.scopeProperties[i],set:t=>e.scopeProperties[i]=t,enumerable:!0,configurable:!0}})),{})),this.modalInstance=this.$uibModal.open({animation:!0,template:e.template,scope:t,size:e.size||"lg",backdrop:e.backdrop||"static",windowClass:e.windowClass||""}),t.closeModal=()=>{this.modalInstance.close(),t.$destroy(),e.onClose?.()},this.modalInstance.result}}const t={en:{barcode:"Barcode",foundXItems:"{1} items found",multipleItemsFound:"Multiple items found",itemCreated:"Item created",itemNotFound:"Item not found!",itemUpdated:"Item updated",notAllItemsActive:"Not all items are active; Do you want to proceed?",oddNumberOfItems:"Odd number of items; Do you want to proceed?",success:"Success",error:"Error",failed:"Failed",loading:"Loading...",nlabelsToBePrinted:"labels to be printed",noData:"No data to print!",invalidId:"Invalid ID",longTimeAgo:"a long time ago",twoMonthsAgo:"two months ago",oneMonthAgo:"a month ago",threeWeeksAgo:"three weeks ago",twoWeeksAgo:"two weeks ago",daysAgo:"{1} days ago",yesterday:"yesterday",hoursAgo:"{1} hours ago",minutesAgo:"{1} minutes ago"},lt:{barcode:"Barkodas",foundXItems:"Rasta {1} prekių",multipleItemsFound:"Rasta daugiau negu viena prekė!",itemCreated:"Prekė sukurta",itemNotFound:"Prekė nerasta!",itemUpdated:"Prekė atnaujinta",notAllItemsActive:"Ne visos prekės aktyvios, ar norite tęsti?",oddNumberOfItems:"Nelyginis prekių skaičius, ar norite tęsti?",success:"Sėkmingai atlikta",error:"Įvyko klaida",failed:"Nepavyko",loading:"Kraunama...",nlabelsToBePrinted:"etiketės spausdinimui",noData:"Nepakanka duomenų spausdinimui!",invalidId:"Neteisingas ID",longTimeAgo:"labai seniai",twoMonthsAgo:"prieš du mėnesius",oneMonthAgo:"prieš mėnesį",threeWeeksAgo:"prieš tris savaites",twoWeeksAgo:"prieš dvi savaites",daysAgo:"prieš {1} dienas",yesterday:"vakar",hoursAgo:"prieš {1} valandas",minutesAgo:"prieš {1} minutes"}},i="lt"===navigator.language.split("-")[0]?"lt":"en",a=(e,a=[])=>{let s=t[i]?.[e]??t.en[e]??e;return a.forEach(((e,t)=>{s=s.replace(`{${t+1}}`,e)})),s};class s{static injector=null;static getInjector(){if(this.injector)return this.injector;const e=document.querySelector("[ng-app]");if(!e)throw new Error("Angular app not found");return this.injector=angular.element(e).injector(),this.injector}static getService(e){return this.getInjector().get(e)}}class r{notifier;items={};baseUrl="https://www.b1.lt";path="/reference-book/items/search";csrfToken;headers;turnstileService;constructor(e){this.notifier=e,this.turnstileService=s.getService("turnstileService");const t=document.querySelector('meta[name="csrf-token"]');this.csrfToken=null!=t?t.content:"",this.headers={accept:"application/json, text/plain, */*","accept-language":"en-GB,en;q=0.9,lt-LT;q=0.8,lt;q=0.7,en-US;q=0.6","content-type":"application/json;charset=UTF-8",origin:this.baseUrl,referer:this.baseUrl,"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest","x-csrf-token":this.csrfToken,cookie:""}}buildRequestBody(e,t=20){return{pageSize:t,filters:{groupOp:"AND",rules:e},allSelected:!1,asString:"",page:1}}async fetchData(e,t,i){if(""===this.csrfToken)return console.error("CSRF token is missing"),void this.notifier.error("CSRF token is missing");const s=t.split("/");s.pop(),this.headers.referer=`${this.baseUrl}${s.join("/")}`,this.getCookies();try{const s=await fetch(`${this.baseUrl}${t}`,{method:e,headers:this.headers,body:JSON.stringify(i)});if(s.ok)return await s.json();if("challenge"===s.headers.get("cf-mitigated")||403===s.status){if(await this.handleChallenge())return console.info("Challenge handled, repeat the request"),await this.fetchData(e,t,i)}else console.error("Request failed with status:",s.status),this.notifier.error({title:a("error"),message:s.statusText})}catch(e){console.error("Error:",e),this.notifier.error("Error: "+e)}}getCookies(){document.cookie.split(";").map((e=>e.trim())).forEach((e=>{const[t,i]=e.split("=");["YII_CSRF_TOKEN","b1-device_id","b1-session_id","b1-use-cookies","b1-wss_srv","b1-ref_url","cf_clearance","_ga"].includes(t.trim())&&(this.headers.cookie=this.headers.cookie.length>0?`${this.headers.cookie}; ${t}=${i}`:`${t}=${i}`)}))}isItDigits(e){return/^\d+$/.test(e)}async getItem(e){if(!this.isItDigits(e))return this.notifier.error("Invalid barcode"),null;if(Object.keys(this.items).includes(e)){const t=this.items[e].retrievedAt;if(null!=t&&e.length>10&&(new Date).getTime()-t.getTime()<3e4)return{...this.items[e]};if(null!=t&&e.length<10&&(new Date).getTime()-t.getTime()<6e4)return{...this.items[e]}}const t={barcode:{data:e,field:"barcode",op:"0"===e[0]?"cn":"eq"}},i=this.buildRequestBody(t),s=await this.fetchData("POST",this.path,i);return null==s||null==s.data[0]?null:(s.data[0].retrievedAt=new Date,this.items[e]=s.data[0],s.data.length>1&&this.notifier.warning({title:a("multipleItemsFound"),delay:2e4,message:a("foundXItems",[s.records])}),s.data[0])}async getRecentlyModifiedItems(e=!1){const t=new Date;t.setHours(0,0,0,0);const i=this.buildRequestBody({isActive:{data:!0,field:"isActive",op:"eq"},modifiedAt:{data:t.toISOString().split("T")[0],field:"modifiedAt",op:"gt"}},200);i.sort={modifiedAt:"desc"};const s=await this.fetchData("POST",this.path,i),r=JSON.parse(localStorage.getItem("items")??"[]"),n=new Date;return s&&s.data&&s.data.forEach((e=>{e.retrievedAt=n,this.items[e.barcode]=e;const t=r.find((t=>t.barcode===e.barcode));t&&t.printedAt&&e.modifiedAt&&new Date(e.modifiedAt).getTime()<=new Date(t.printedAt).getTime()&&(e.noNeedToPrint=!0)})),e&&this.notifier.info(a("foundXItems",[s.records])),s.data||[]}async getItemsByIds(e){const t={id:{data:e,field:"id",op:"in"}},i=this.buildRequestBody(t,20),s=await this.fetchData("POST",this.path,i);return s&&s.data&&s.data.forEach((e=>{e.retrievedAt=new Date,this.items[e.barcode]=e})),200===s.code?this.notifier.success({title:a("success"),message:a("foundXItems",[s.records])}):this.notifier.error({title:a("error"),message:s.message}),s.data||[]}async getAllItemsBatch(e=1,t=100){const i=this.buildRequestBody({},t);i.page=e;const a=await this.fetchData("POST",this.path,i);if(a&&a.data){const i=a.data.length===t&&e*t<a.records;return{data:a.data,hasMore:i}}return{data:[],hasMore:!1}}async getItemMovements(e,t,i){const s={itemId:{data:e,field:"itemId",op:"eq"},warehouseId:{data:i,field:"warehouseId",op:"eq"},date:{data:t,field:"date",op:"eq"}},r=this.buildRequestBody(s,20);r.sort={};const n=await this.fetchData("POST","/warehouse/item-movement/search",r);return 200===n.code?this.notifier.success({title:a("success"),message:a("foundXItems",[n.records])}):this.notifier.error({title:a("error"),message:n.message}),n.data||[]}async saveItem(e,t){if(!this.isItDigits(e))return this.notifier.error(a("invalidId")),!1;const i=await this.fetchData("POST",`/reference-book/items/update?id=${e}`,t);return 200===i.code?this.notifier.success({title:a("itemUpdated"),message:a("newPriceIs")+" "+t.priceWithVat,delay:15e3}):this.notifier.error({title:a("failedToUpdateItem"),message:i.message}),200===i.code}async quickPriceChange(e){const t=prompt(a("enterNewPrice"),(e.priceWithVat??0).toString());if(null==t||null==e.id)return this.notifier.info(a("error")),!1;const i=new Object;return i.isActive=!0,i.id=e.id,i.priceWithVat=parseFloat(t.replace(",",".")),i.priceWithVat<=0?(this.notifier.error(a("missingPrice")),!1):(i.priceWithoutVat=i.priceWithVat/1.21,i.priceWithoutVat=Math.round(1e4*(i.priceWithoutVat+Number.EPSILON))/1e4,e.priceWithVat=i.priceWithVat,e.priceWithoutVat=i.priceWithoutVat,this.saveItem(i.id,i))}async createItem(e){const t=await this.fetchData("POST","/reference-book/items/create",e);return 200===t.code?(this.notifier.success(a("itemCreated")),setTimeout((()=>{this.saveItem(t.data.id,{isActive:!0})}),400)):this.notifier.error({title:a("failedToCreateItem"),message:t.message}),200===t.code}async getSales(e){const t={operationTypeName:{data:e,field:"operationTypeName",op:"cn"}},i=this.buildRequestBody(t,20);i.sort={saleDate:"desc"};return this.fetchData("POST","/warehouse/light-sales/search",i)}getSaleItems(e){const t={lightSaleId:{field:"lightSaleId",op:"eq",data:e}},i=this.buildRequestBody(t,-1);return this.fetchData("POST","/warehouse/light-sale-items/search",i)}async handleChallenge(){try{return await this.turnstileService.render(),console.info("Turnstile challenge passed!"),!0}catch(e){return console.error("Turnstile challenge failed.",e),!1}}}class n{notificationService;constructor(){try{this.notificationService=s.getService("Notification")}catch(e){console.error("Failed to get Notification service",e),this.notificationService={info:e=>alert(e),error:e=>alert(e),success:e=>alert(e),warning:e=>alert(e),primary:e=>alert(e)}}}info(e){this.notificationService.info(e)}error(e){this.notificationService.error(e)}success(e){this.notificationService.success(e)}warning(e){this.notificationService.warning(e)}primary(e){this.notificationService.primary(e)}}class o{wereButtonsAdded=!1;notification=new n;currentUrl;constructor(){this.currentUrl=window.location.pathname,this.init(),this.handleUrlChange(null,this.currentUrl)}init(){this.handleUrlChange(null,this.currentUrl),this.addStyles()}async handleUrlChange(e,t,i=0){"/login"==this.currentUrl||this.wereButtonsAdded||(this.wereButtonsAdded=this.addButton("Rodyti antkainius",this.listMarkup.bind(this))&&this.addButton("Peržiūrėti prekės judėjimą",this.goToItemMovement.bind(this)),t.includes("/warehouse/sales")&&this.addButton("Trinti pardavimus",this.deleteSales.bind(this)),!this.wereButtonsAdded&&i<5&&setTimeout((()=>{this.handleUrlChange(null,this.currentUrl,i+1)}),600)),"/warehouse/item-movement"===t&&this.addInsightsBlock()}getDataRows(e=!0){const t=document.querySelector(".data-rows");if(null==t)throw e&&this.notification.error("Įvyko klaida: nepavyko rasti duomenų eilučių"),new Error("Data rows not found");return t}goToItemMovement(){const e=this.getDataRows(),t=angular.element(e).controller(),i=(t.data??t.grid.data).filter((e=>e._select)).pop();if(null==i)return void this.notification.error("Pasirinkite prekę");if(null==i.id&&null==i.itemId)return void this.notification.error("Prekės ID nerastas");const a=new URL("/warehouse/item-movement",window.location.origin);a.searchParams.append("itemId",i.itemId??i.id),a.searchParams.append("itemName",i.name??i.itemName),a.searchParams.append("warehouseId","1"),a.searchParams.append("warehouseName","Pagrindinis"),window.open(a.toString(),"_blank")}calculateMarkup(e,t){return(e-t)/t*100}async listMarkup(){if("/en/warehouse/purchases/edit"!==window.location.pathname&&"/warehouse/purchases/edit"!==window.location.pathname)return void this.notification.error("Įvyko klaida: ši funkcija veikia tik pirkimo sąskaitų peržiūros lange");const t=angular.element(this.getDataRows()).controller();(new e).showModal({template:'\n      <div class="modal-header">\n        <button type="button" class="close" ng-click="closeModal()">&times</button>\n        <h4 class="modal-title">Antkainių sąrašas</h4>\n      </div>\n      <div class="modal-body extd-grid">\n        <table class="table table-bordered">\n          <thead>\n            <tr>\n              <th>Pavadinimas</th>\n              <th class="width-100-strict">Kaina be PVM</th>\n              <th class="width-100-strict">Antkainis</th>\n              <th class="width-130-strict">Pardavimo kaina su PVM</th>\n              <th class="width-100-strict">Min. kaina 20%</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr ng-repeat="item in data">\n              <td>{{ item.itemName }}</td>\n              <td>{{ item.priceWithoutVatWithDiscount.toFixed(3) }}</td>\n              <td ng-class="{ \'background-white-red\': calculateMarkup(item.itemPriceWithVat, item.priceWithoutVatWithDiscount * (1 + (item.vatRate / 100))) < 19.5 }">{{ calculateMarkup(item.itemPriceWithVat, item.priceWithoutVatWithDiscount * (1 + (item.vatRate / 100))).toFixed(2) }}%</td>\n              <td>\n                <span>{{ item.itemPriceWithVat == null ? "-" : item.itemPriceWithVat }}</span>\n                <button class="btn btn-xs btn-primary pull-right" style="margin-left: 10px;" ng-click="editPrice(item)">Keisti</button>\n              </td>\n              <td>{{ (item.priceWithoutVatWithDiscount * (1 + (item.vatRate / 100)) * 1.2).toFixed(3) }}</td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" ng-click="closeModal()">Uždaryti</button>\n      </div>\n      ',scopeProperties:{data:t.data,calculateMarkup:this.calculateMarkup,editPrice:this.editPrice.bind(this)},size:"lg",backdrop:"static"})}addButton(e,t){const i=document.querySelector(".breadcrumbs");if(null!=i){const a=document.createElement("button");a.textContent=e,a.className="btn btn-sm",a.addEventListener("click",t),i.appendChild(a)}return null!=i}async editPrice(e){const t=window.prompt("Įveskite naują kainą",e.itemPriceWithVat?.toString()??"");if(null==t)return;const i=parseFloat(t.replace(",","."));if(i<=0)this.notification.error("Neteisinga kaina");else{e.itemPriceWithVat=i;let t=i/1.21;t=Math.round(1e4*(t+Number.EPSILON))/1e4;const a={isActive:!0,priceWithVat:i,priceWithoutVat:t};new r(this.notification).saveItem(e.itemId.toString(),a)}}async deleteSales(){const e=window.prompt("Įveskite prekės barkodą, kurio pardavimo prekes norite ištrinti","");if(null==e||""===e.trim())return void this.notification.error("Neteisingas prekės kodas");if("/en/warehouse/sales"!==window.location.pathname&&"/warehouse/sales"!==window.location.pathname)return void this.notification.error("Įvyko klaida: ši funkcija veikia tik pardavimų sąrašo peržiūros lange");const t=angular.element(this.getDataRows()).controller().data.filter((e=>e._select)).map((e=>e.id)),i=new r(this.notification);if(0!==t.length)for(const a of t){const t=await i.fetchData("POST","/warehouse/sale-items/search",{filters:{rules:{itemBarcode:{field:"itemBarcode",op:"cn",data:e},saleId:{field:"saleId",op:"eq",data:a}}},page:1,pageSize:100,sort:{position:"asc"},asString:`[Pardavimas:${a}]`});if(0===t.records){this.notification.error(`Nepavyko rasti pardavimo prekių su ID ${a} ir prekės kodu ${e}`);continue}!1!==(await i.fetchData("POST","/warehouse/sale-items/delete",{ids:t.data.map((e=>e.id))})).success?t.data.forEach((e=>{this.notification.success(`Pardavimo prekė su ID ${e.id} ištrinta sėkmingai`)})):this.notification.error(`Nepavyko ištrinti pardavimo prekių su ID ${t.data.map((e=>e.id)).join(", ")}`)}else this.notification.error("Pasirinkite pardavimus")}addStyles(){const e=document.createElement("style");e.innerHTML='ng-form textarea.form-control.input-sm.ng-pristine.ng-untouched.ng-valid{height:50px}ng-form label:has(input[name=isActive]){margin-left:-0.5em}ng-form input[name=isActive].ace+span{background-color:#b74635;color:#fff;padding:.75em 5em .75em .5em;border-radius:4px}ng-form input[name=isActive].ace:checked+span{background-color:#fff;color:inherit}ng-form.simplified-form h5.header.blue,ng-form .alert.alert-warning{display:none}.row[ng-controller="CashRegisterSaleEdit as c"] .row .row .col-lg-6{display:none}',document.head.appendChild(e)}inferDeliveryDays(e){const t=new Date;t.setMonth(t.getMonth()-2);const i=e.filter((e=>e.purchase_date&&new Date(e.purchase_date)>=t)),a={};return i.forEach((e=>{const t=new Date(e.purchase_date).toLocaleDateString("en-US",{weekday:"long"});a[t]=(a[t]||0)+1})),Object.entries(a).sort(((e,t)=>t[1]-e[1])).map((([e])=>e)).slice(0,3)}getDayDifference(e,t){const i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/864e5)}addInsightsBlock(e=0){if("/en/warehouse/item-movement"!==window.location.pathname&&"/warehouse/item-movement"!==window.location.pathname)return void this.notification.error("Įvyko klaida: ši funkcija veikia tik prekės judėjimo peržiūros lange");let t;try{t=this.getDataRows(e>3)}catch(t){return console.error("Error getting data rows:",t),void(e<3&&setTimeout((()=>{this.addInsightsBlock(++e)}),500))}const i=angular.element(t).controller();if(null==i.grid.data||i.grid.data.length<2)return this.addButton("Pirkimo įžvalgos",(()=>this.addInsightsBlock())),void this.notification.error("Nepakanka duomenų");const a={pirk_data:"purchase_date",pirk_kiekis:"purchase_qty",savikaina:"cost_price",pard_data:"sale_date",pard_dok:"sale_doc",pard_kiekis:"sale_qty",pard_kaina:"sale_price",likutis:"balance",kainu_skirtumas:"price_difference"},s=i.grid.data.map((e=>{const t={};for(const i in e)Object.prototype.hasOwnProperty.call(a,i)&&(t[a[i]]=e[i]);return t}));if(0===s.length)return void this.notification.error("Nepavyko rasti prekės judėjimo duomenų");const r=s.filter((e=>e.sale_date)),n=s.filter((e=>e.purchase_date)),o=new Map;let c=0;for(const e of s){const t=e.sale_date||e.purchase_date;if(!t)continue;const i=t.slice(0,10);o.has(i)||o.set(i,{sales:0,purchases:0,balance:null});const a=o.get(i);e.sale_date&&(a.sales+=parseFloat(e.sale_qty),a.balance=parseFloat(e.balance)),e.purchase_date&&(a.purchases+=parseFloat(e.purchase_qty),null===a.balance&&(a.balance=c+parseFloat(e.purchase_qty))),null!==a.balance&&(c=a.balance)}const d=Array.from(o.keys()),l=d.map((e=>o.get(e).sales)),u=d.map((e=>o.get(e).purchases)),h=d.map((e=>o.get(e).balance)),m=new Date(r[0].sale_date),p=new Date(r[r.length-1].sale_date),g=Math.max(1,Math.round((p.getTime()-m.getTime())/6048e5)),f=r.reduce(((e,t)=>parseFloat(t.price_difference)<=0?e+parseFloat(t.sale_qty):e),0),k=r.reduce(((e,t)=>parseFloat(t.price_difference)>0?e+parseFloat(t.sale_qty):e),0),w=k/g,y=f/(k+f)*100,v=this.inferDeliveryDays(n);if(0===v.length)return void this.notification.error("Nepavyko nustatyti pristatymo dienų");const b=new Date;b.setHours(0,0,0,0);const I=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],D=v.map((e=>{const t=(I.indexOf(e)-b.getDay()+7)%7;return new Date(b.getFullYear(),b.getMonth(),b.getDate()+t)})).sort(((e,t)=>e.getTime()-t.getTime())),S=D[0],P=S.toLocaleDateString("lt-LT",{month:"long",day:"numeric"}),T=D[1]||new Date(S.getFullYear(),S.getMonth(),S.getDate()+7),A=T.toLocaleDateString("lt-LT",{month:"long",day:"numeric"}),M=w/7*this.getDayDifference(b,S),_=w/7*this.getDayDifference(b,T),N=Math.max(0,Math.ceil(M+_-c)),x=s.filter((e=>0===e.balance&&e.sale_date)).map((e=>new Date(e.sale_date))),$=x.length;if($>0){const e=x[0].toLocaleDateString("lt-LT",{month:"long",day:"numeric"}),t=x[x.length-1].toLocaleDateString("lt-LT",{month:"long",day:"numeric"});this.notification.info(`Prekė buvo išparduota nuo ${e} iki ${t}. Iš viso: ${$} dienų.`)}else this.notification.info("Prekė niekada nebuvo išparduota");const q=document.querySelector(".card");q&&q.remove();const j=document.createElement("div");j.style.maxWidth="800px",j.style.margin="40px auto",j.innerHTML=`\n      <div class="card" style="display: flex; flex-wrap: wrap;">\n      <div class="card-body" style="flex: 1 1 350px; min-width: 350px;">\n        <div style="margin-bottom: 16px;">\n        <p><strong>Šiuo metu likutis:</strong> ${c.toFixed(2)}</p>\n        <p><strong>Rekomenduojamas užsakymo kiekis:</strong> ${N}</p>\n        </div>\n        <hr>\n        <p><strong>Vidutiniai savaitiniai pardavimai:</strong> ${w.toFixed(2)}</p>\n        <p><strong>Vidutis dienos pardavimas:</strong> ${(w/7).toFixed(2)}</p>\n        <p><strong>Dalies pasibaigusių prekių:</strong> ${y.toFixed(2)}%</p>\n        <p><strong>Numatomas poreikis (iki ${P}):</strong> ${M.toFixed(2)}</p>\n        <p><strong>Numatomas poreikis (iki ${A}):</strong> ${_.toFixed(2)}</p>\n        <p><strong>Pristatymo dienos:</strong> ${v.join(", ")}</p>\n      </div>\n      <div style="flex: 1 1 350px; min-width: 350px; display: flex; align-items: center; justify-content: center;">\n        <canvas id="stockChart" style="max-width: 100%; height: 320px;"></canvas>\n      </div>\n      </div>\n    `;const C=document.querySelector("div[ng-view]");if(null==C)return void this.notification.error("Nepavyko rasti ng-view elemento");C.insertAdjacentElement("beforebegin",j);const W=document.getElementById("stockChart");null!=W?new Chart(W.getContext("2d"),{type:"line",data:{labels:d,datasets:[{label:"Pardavimai",data:l,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",tension:.3},{label:"Pirkimai",data:u.map((e=>e>0?e:null)),borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.8)",type:"bar",spanGaps:!1},{label:"Likutis",data:h,borderColor:"rgba(122, 170, 170, 1)",backgroundColor:"rgba(97, 139, 139, 0.2)",tension:.3,yAxisID:"y"}]},options:{scales:{y:{beginAtZero:!0}}}}):this.notification.error("Nepavyko rasti canvas elemento")}}window.addEventListener("load",(()=>{new o}))}();
